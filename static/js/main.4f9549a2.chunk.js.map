{"version":3,"sources":["components/Node/Node.module.scss","components/ExpandedNode/ExpandedNode.module.scss","camino-logo-dark.png","components/PathwayPopup/PathwayPopup.module.scss","components/Graph/Graph.module.scss","styles/index.module.scss","components/PatientRecord/PatientRecord.module.scss","components/ReportModal/ReportSection/ReportSection.module.scss","utils/ConfigManager.js","components/MissingDataPopup/MissingDataPopup.module.scss","styles/theme.tsx","components/ThemeProvider.tsx","components/Header/Header.tsx","components/PatientProvider.tsx","components/PatientSnapshot/PatientSnapshot.tsx","components/PathwayProvider.tsx","components/UserProvider.tsx","components/NoteDataProvider.tsx","utils/fhirUtils.ts","components/PatientRecordsProvider.tsx","components/DropDown/DropDown.tsx","components/Navigation/Navigation.tsx","utils/patient.js","utils/fhirExtract.js","components/FHIRClient.tsx","engine/cql-extractor.ts","utils/regexes.ts","engine/cql-to-elm.ts","engine/elm-executor.ts","engine/output-results.ts","engine/evaluate-patient.ts","components/PatientRecord/PatientRecord.tsx","visualization/layout.ts","components/PathwayPopup/PathwayPopup.tsx","components/ActionButton/ActionButton.tsx","components/MissingDataPopup/MissingDataPopup.tsx","components/ReportModal/ReportSection/ReportSection.tsx","components/ReportModal/ReportModal.tsx","components/ExpandedNode/ExpandedNode.tsx","utils/nodeUtils.ts","components/Node/Node.tsx","components/Arrow/Arrow.tsx","components/Graph/Graph.tsx","components/PathwaysList/PathwaysList.tsx","components/PathwaysService/PathwaysService.tsx","utils/MockedFHIRClient.ts","components/App.tsx","index.js","components/ActionButton/ActionButton.module.scss","components/PatientSnapshot/PatientSnapshot.module.scss","components/Navigation/Navigation.module.scss","components/ReportModal/ReportModal.module.scss","components/Arrow/Arrow.module.scss","components/DropDown/DropDown.module.scss","components/App.module.scss","components/PathwaysList/PathwaysList.module.scss"],"names":["module","exports","config","this","global","CONFIG","name","defaultValue","parts","split","context","value","i","conf","colors","white","black","blue","red","gray","grayMedium","grayBlue","grayLighter","green","typography","fontFamily","materialUiOverridesBase","MuiButton","root","borderRadius","label","fontWeight","iconSizeMedium","fontSize","iconSizeSmall","theme","createMuiTheme","palette","primary","main","secondary","common","background","default","text","overrides","projectorTheme","ThemeContext","createContext","ThemeProvider","children","useState","defaultTheme","setTheme","toggleTheme","useCallback","currentTheme","Provider","Header","props","anchorEl","setAnchorEl","useContext","handleClose","className","styles","header","src","logo","alt","onClick","event","currentTarget","aria-controls","aria-haspopup","icon","faCog","Menu","id","keepMounted","open","Boolean","onClose","MenuItem","PatientContext","patient","setPatient","PatientProvider","usePatient","useStyles","makeStyles","color","PatientSnapshot","classes","useMemo","entry","find","n","use","given","join","family","getPatientName","address","city","state","filter","item","getPatientAddress","age","birthDateString","today","Date","birthDate","getFullYear","m","getMonth","getDate","getPatientAge","patientSnapshot","faUserCircle","patientSnapshot__photo","patientSnapshot__info","patientName","clsx","patientSnapshot__list","gender","PathwayContext","evaluatedPathway","setEvaluatedPathway","updateEvaluatedPathways","assignPathway","unassignPathway","PathwayProvider","pathwayCtx","usePathwayContext","UserContext","user","setUser","UserProvider","NoteContext","note","setNote","NoteDataProvider","date","getHumanName","toDateString","physician","birthdate","mcodeElements","pathway","status","useNote","toString","Object","keys","forEach","element","node","treatment","notes","person","Array","isArray","prefix","suffix","createDocumentReference","data","resourceType","v1","meta","lastUpdated","getCurrentTime","subject","reference","content","attachment","btoa","contentType","type","coding","system","code","display","indexed","createActionDocumentReference","labelOrCondition","documentReference","identifier","createNoteContent","patientRecords","actionNode","action","description","tnm","record","profile","length","elements","includes","obs","valueCodeableConcept","some","index","findIndex","now","withLeadingZero","getDay","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","pathwayIsAssigned","r","map","title","getTNM","retrieveNote","condition","resources","resource","undefined","PatientRecordsContext","setPatientRecords","evaluatePath","setEvaluatePath","mcodeRecords","setMcodeRecords","PatientRecordsProvider","usePatientRecords","DropDown","options","visible","onChange","selectedValue","setSelectPathway","onChangeCallback","assigned","dropdown","htmlFor","Button","variant","startIcon","faThList","alert","faTimesCircle","faCheckCircle","classNamePrefix","inputId","aria-label","formatOptionLabel","option","check","navigation","backgroundColor","Navigation","evaluatedPathways","selectPathway","onBack","pathwayOptions","navigation__leftPanel","faChevronLeft","navigation__back","navigation__rightPanel","pathwayOption","ALL_RESOURCES_PATIENT_REFERENCE","mapperName","get","MapperClass","mappers","mapperInstance","applyMapping","bundle","execute","getEverythingManually","client","supportedResources","push","requests","request","flat","pageLimit","then","result","catch","error","console","log","Promise","all","results","x","getEverythingRevInclude","onError","query","FHIRClientContext","FHIRClientProvider","useFHIRClient","extractCQL","resolve","reject","libraries","library","slice","l","libraryLine","trim","startsWith","Error","trimmed","firstSpace","indexOf","secondSpace","substring","libName","extractMultipartBoundary","extractMultipartFileName","extractJSONContent","url","executeElm","patientRecord","elm","lib","Library","Repository","executor","Executor","psource","PatientSource","FHIRv401","loadBundles","exec","pathwayData","patientData","currentNodes","nextNodes","documentation","nodeKey","currentNode","nodes","getStatusAndResource","onPath","dr","retrieveResource","getNextNodes","patientDocumentation","nodesWithDocumentation","values","doc","entries","transitions","transition","getNonPathDocumentation","patientId","Patient","key","actionResource","atob","shouldAdvance","t","branchNote","noteChoice","evaluatePathwayPreconditions","preconditions","processELMCommon","cql","processCQLCommon","resultItems","matches","precondition","evaluationResult","elementName","actual","match","preconditionResultItem","expected","pathwayName","preconditionResultItems","preconditionData","formdata","FormData","append","fetch","method","body","headers","boundary","obj","reduce","oldArray","line","elmName","JSON","parse","convertCQL","Accept","json","convertBasicCQL","elmResults","patientIds","patientResults","recordSections","getResourcesByType","groupedResources","PatientRecordElement","recordSection","isExpanded","setIsExpanded","chevron","faChevronUp","faChevronDown","resourceCount","expand","visualizerContainer","resourcesByType","Visualizer","rows","PathwayVisualizer","setPreconditions","useEffect","preconditionResult","c","McodeVisualizer","keysArray","PatientRecord","headerElement","recordContainerElement","useRef","Map","collection","set","groupResourceByType","current","style","height","window","innerHeight","clientHeight","ref","sidebar","recordToggle","faNotesMedical","graphLayoutProvider","layout","nodeDimensions","nodeKeys","g","dagre","graphlib","Graph","setGraph","setDefaultEdgeLabel","nodeDimension","setNode","width","setEdge","nodeCoordinates","startNodeShift","y","edges","e","edge","edgeName","v","w","start","end","points","p","layoutDagre","START","rank","NaN","horizontalPosition","parents","canMove","initializeNodes","graph","HORIZONTAL_OFFSET","NODE_WIDTH","VERTICAL_OFFSET","NODE_HEIGHT","assignRankToChildren","assignHorizontalPositionToNode","assignHorizontalPositionToNodesInRank","coordinates","produceCoordinates","hPos","isNaN","hasOverlap","direction","Math","ceil","parentsOnHigherRank","parentName","parent","floor","splice","childNode","spreadChildrenEvenly","sum","a","b","nodesInRank","nodesOverlap","otherNode","nodesEqual","child","assignRankToNode","err","layoutCustom","PathwayPopup","Content","Trigger","popupPosition","setOpen","Popup","position","pathwayPopup","on","onOpen","pinned","trigger","LargeActionButton","toUpperCase","SmallActionButton","accept","decline","smallActionButton","data-testid","faCheck","faTimes","MediumActionButton","mediumActionButton","ActionButton","size","PopupContent","showCheck","setShowCheck","selected","setSelected","popupContent","popupChoice","footer","create","MissingDataPopup","missingDataPopup","popupTrigger","faEdit","externalLink","ReportField","sectionTitle","field","PhysicianNotesSection","sectionContainer","sectionIconContainer","notesField","ReportSection","fields","fieldContainer","shortid","generate","ReportModal","onConfirm","onDecline","patientSection","observationField","Laterality","pathwaySection","reportModal","faUser","faRoute","faStickyNote","confirmationSection","confirmationButtonGroup","ExpandedNode","memo","isActionable","isCurrentNode","isAction","isAccepted","showReport","setShowReport","newPatientRecords","pathwayResource","resourceProperties","intent","authoredOn","toISOString","medicationCodeableConcept","translatePathwayRecommendation","ExpandedNodeMemo","setComments","nc","prevNote","comments","onAccept","onAdvance","ExpandedNodeField","descTitle","desc","StatusField","rawDate","toLocaleString","titleText","charAt","concat","isMedicationRequest","isServiceRequest","returnElements","href","target","rel","faExternalLinkAlt","procedure","performedPeriod","performedDateTime","renderAction","branch","pathwayNode","observation","valueCoding","effectiveDateTime","identifierArray","documentReferenceIdentifier","arr","renderBranch","defaultText","indexStyles","expandedNode","infoTable","test","button","commentsForm","preventDefault","borderColor","Node","forwardRef","isOnPatientPath","xCoordinate","yCoordinate","expanded","onClickHandler","top","left","backgroundColorClass","onPatientPath","notOnPatientPath","topLevelClasses","expandedNodeClass","nodeStyles","actionable","childActionable","childOnPatientPath","childNotOnPatientPath","declined","childDeclined","nodeTitle","clickable","iconAndLabel","NodeIcon","faMicroscope","faPlay","faPrescriptionBottleAlt","faSyringe","faBookMedical","StatusIcon","statusIcon","ArrowPath","arrowheadId","widthOffset","pointsWithOffset","remainder","pathString","acc","point","d","fill","markerEnd","Arrow","arrowOnPatientPath","arrow","edgeNameNoWhitespace","replace","arrowhead","markerWidth","markerHeight","refX","refY","orient","getPath","pathwayResults","isEdgeOnPatientPath","path","startIndex","endIndex","interactive","expandCurrentNode","graphElement","nodeRefs","parentElement","clientWidth","parentWidth","setParentWidth","setPath","getGraphLayout","nodeElement","from","graphLayout","setLayout","maxHeight","max","minX","min","toAdd","layoutKeys","initialExpandedNode","curr","_setExpanded","setExpanded","prevState","cancel","navigational","evaluatePatientOnPathway","ResizeSensor","maxWidth","GraphMemo","marginRight","docResource","xmlns","zIndex","overflow","PathwaysListElement","callback","isVisible","setIsVisible","pathwayElementClass","assignedPathwayElement","pathwayElement","titleClass","role","numElements","infoContainer","details","matchingElement","faEye","controls","faPlus","faMinus","PathwaysList","service","preconditionPromises","preconditionResults","sort","assignedPathways","carePlanTitles","getAssignedPathways","pathways_list","container","pathwayListHeaderContainer","header_title","header_title__header","header_title__note","matchedElementsLabel","faCaretDown","useGetPathwaysService","setResult","getPathways","response","listOfFiles","f","typedFetch","listOfPromises","pathwaysList","payload","MockedFHIRClient","PatientView","graphContainerElement","App","demoId","_setPatientRecords","_setMcodeRecords","currentPathway","setCurrentPathway","setEvaluatedPathways","setClient","filename","elmString","mcodeData","providerProps","resultPatient","FHIR","oauth2","init","clientId","scope","statement","rest","operation","definition","getEverything","revIncludeResources","searchRevInclude","searchInclude","filters","searchParam","searchParams","getPatientRecord","records","every","read","setEvaluatedPathwayCallback","scrollTo","newList","carePlan","R4","NarrativeStatusKind","_generated","div","category","createCarePlan","delete","rootElement","document","getElementById","ReactDOM","render","exact","params"],"mappings":"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AW4D,YAAK3D,KAAO4L,WAAYhK,EAAQgK,aAC9C,yBAAK7L,UAAWC,KAAOmM,uBACpBF,GACC,kBAAC,IAAD,CACEvL,KAAM0L,IACNrM,UAAWC,KAAOqM,iBAClBhM,QAAS4L,IAIb,kBAAC,EAAD,OAGF,yBAAKlM,UAAWC,KAAOsM,wBACrB,kBAAC,GAAD,CACEzO,MAAM,WACNgD,GAAG,eACH0J,SAAUyB,EACV1B,QAAS4B,EACTzB,cAAe/N,EACfgO,iBAAkBA,EAClBF,SAjCgB,SAAC+B,GACD,OAAlBA,GAA0B,UAAWA,GACvClI,EAAWL,oBAAoBuI,EAAc7P,a,sBCvC7C8P,GAAkC,CACtC,0BACA,2BACA,eACA,kBACA,4BACA,0BACA,yBACA,mBACA,uBACA,8BACA,oBACA,wBACA,6BACA,mBACA,wBACA,oBACA,eACA,uBACA,6BACA,2BACA,eACA,sBACA,2BACA,yBACA,oBACA,sBACA,wBACA,yBACA,6BACA,6BACA,eACA,iBACA,eACA,aACA,aACA,gBACA,0BACA,mBACA,mBACA,8BACA,gCACA,+BACA,iCACA,gCACA,mBACA,iBACA,yBACA,0BACA,6BACA,uBACA,2BACA,uBACA,0BACA,wBACA,0BACA,4BACA,gCACA,+BACA,gCACA,+BACA,oBACA,wBACA,qBACA,mBACA,0BACA,2BACA,4BACA,6BACA,4BACA,oBACA,sBACA,2BACA,6BACA,8BACA,4BACA,6BACA,iBACA,cACA,yBACA,wBACA,eACA,sBACA,wBACA,sBACA,6BACA,8BACA,4BACA,8BACA,6BACA,8BACA,+BACA,mCACA,4BACA,mCACA,8BACA,6BACA,qCACA,gBACA,gBACA,wBACA,oBACA,sBACA,uBACA,qBACA,sBACA,eACA,YACA,cACA,oBACA,sBACA,uBACA,sBACA,qBACA,+BACA,qCACA,yBACA,2BACA,2BACA,eACA,eACA,eACA,cACA,+BACA,6BACA,4BACA,4BACA,oBACA,6BACA,4BACA,gCACA,2BACA,2BACA,+BACA,+BACA,6BACA,2BACA,0BACA,6BACA,wBACA,6BACA,0B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","file":"static/js/main.4f9549a2.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"node\":\"Node_node__38uoJ\",\"icon\":\"Node_icon__354W4\",\"statusIcon\":\"Node_statusIcon__NkBGU\",\"onPatientPath\":\"Node_onPatientPath__3LPjE\",\"actionable\":\"Node_actionable__bHXKd\",\"declined\":\"Node_declined__2Dd-4\",\"notOnPatientPath\":\"Node_notOnPatientPath__24OpF\",\"expandedNode\":\"Node_expandedNode__1ar-A\",\"childOnPatientPath\":\"Node_childOnPatientPath__28UD6\",\"childActionable\":\"Node_childActionable__SwUjD\",\"childNotOnPatientPath\":\"Node_childNotOnPatientPath__2j4QB\",\"childDeclined\":\"Node_childDeclined__2Gx9j\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"infoTable\":\"ExpandedNode_infoTable__3v2tx\",\"descTitle\":\"ExpandedNode_descTitle__15ki8\",\"desc\":\"ExpandedNode_desc__3Xdkf\",\"externalLink\":\"ExpandedNode_externalLink__1Mr1x\",\"button\":\"ExpandedNode_button__Tvpk5\",\"commentsForm\":\"ExpandedNode_commentsForm__3Q20Y\",\"footer\":\"ExpandedNode_footer__FOCYI\",\"comments\":\"ExpandedNode_comments__9q-JW\"};","module.exports = __webpack_public_path__ + \"static/media/camino-logo-dark.c8fc712a.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"pathwayPopup\":\"PathwayPopup_pathwayPopup__2moYb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Graph_root__1SJOc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"expanded\":\"styles_expanded__XNUv-\",\"expandedNode\":\"styles_expandedNode__26Fy8\",\"nodeTitle\":\"styles_nodeTitle__5mm8f\",\"clickable\":\"styles_clickable__3HzZZ\",\"iconAndLabel\":\"styles_iconAndLabel__2LOTu\",\"statusIcon\":\"styles_statusIcon__2jDwI\",\"button\":\"styles_button__1AUjr\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"record\":\"PatientRecord_record__2CgGD\",\"recordToggle\":\"PatientRecord_recordToggle__2Vhvd\",\"sidebar\":\"PatientRecord_sidebar__1Box0\",\"element\":\"PatientRecord_element__RKq2B\",\"title\":\"PatientRecord_title__2U0uE\",\"expand\":\"PatientRecord_expand__M9HFP\",\"visualizerContainer\":\"PatientRecord_visualizerContainer__PamdD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fieldContainer\":\"ReportSection_fieldContainer__3LwUq\",\"field\":\"ReportSection_field__Cxwdy\",\"sectionContainer\":\"ReportSection_sectionContainer__3gJ8s\",\"sectionIconContainer\":\"ReportSection_sectionIconContainer__3pp4w\",\"icon\":\"ReportSection_icon__1NGg-\",\"notesField\":\"ReportSection_notesField__67Cly\"};","export class ConfigManager {\n  constructor(config = {}) {\n    this.config = global.CONFIG ? { ...global.CONFIG, ...config } : { ...config };\n  }\n\n  get(name, defaultValue) {\n    const parts = name.split('.');\n    let context = this.config;\n    let value = null;\n    for (const i in parts) {\n      const part = parts[i];\n      value = context[part];\n      context = value;\n    }\n    return value || defaultValue;\n  }\n\n  add(conf) {\n    if (conf) {\n      this.config = {\n        ...this.config,\n        ...conf\n      };\n    }\n  }\n}\n\nconst config = new ConfigManager();\nexport default config;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"missingDataPopup\":\"MissingDataPopup_missingDataPopup__A-EBJ\",\"popupContent\":\"MissingDataPopup_popupContent__24BvC\",\"popupTrigger\":\"MissingDataPopup_popupTrigger__11eAy\",\"popupChoice\":\"MissingDataPopup_popupChoice__5oEld\",\"selected\":\"MissingDataPopup_selected__20Or7\",\"footer\":\"MissingDataPopup_footer__1wJXm\",\"externalLink\":\"MissingDataPopup_externalLink__3oYt-\"};","import { createMuiTheme } from '@material-ui/core/styles';\n\nconst colors = {\n  white: '#fff',\n  black: '#222',\n  blue: '#5d89a1',\n  red: '#d95d77',\n  gray: '#4a4a4a',\n  grayMedium: '#bbbdc0',\n  grayBlue: '#cbd5df',\n  grayLighter: '#eaeef2',\n  green: '#2fa874'\n};\n\nconst typography = {\n  fontFamily:\n    \"'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif\"\n};\n\nconst materialUiOverridesBase = {\n  MuiButton: {\n    root: {\n      borderRadius: 0\n    },\n    label: {\n      fontWeight: 600\n    },\n    iconSizeMedium: {\n      '& > *:first-child': {\n        fontSize: 14\n      }\n    },\n    iconSizeSmall: {\n      '& > *:first-child': {\n        fontSize: 14\n      }\n    }\n  }\n};\n\nconst theme = createMuiTheme({\n  typography: { ...typography },\n  palette: {\n    primary: {\n      main: colors.blue\n    },\n    secondary: {\n      main: colors.red\n    },\n    common: colors,\n    background: {\n      default: colors.grayLighter\n    },\n    text: {\n      primary: colors.gray,\n      secondary: colors.gray\n    }\n  },\n  overrides: { ...materialUiOverridesBase }\n});\n\nconst projectorTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: {\n    primary: {\n      main: colors.blue\n    },\n    secondary: {\n      main: colors.red\n    },\n    common: colors,\n    background: {\n      default: colors.grayBlue\n    },\n    text: {\n      primary: colors.black,\n      secondary: colors.black\n    }\n  },\n  overrides: { ...materialUiOverridesBase }\n});\n\nexport default theme;\nexport { theme, projectorTheme };\n","import React, { FC, createContext, useState, useCallback, useContext, ReactNode } from 'react';\nimport { ThemeProvider as MuiThemeProvider } from '@material-ui/core/styles';\nimport { theme as defaultTheme, projectorTheme } from '../styles/theme';\n\ninterface ThemeProviderProps {\n  children: ReactNode;\n}\n\nexport const ThemeContext = createContext(() => {\n  // this comment does nothing but make eslint happy :)\n});\nexport const useThemeToggle = (): (() => void) => useContext(ThemeContext);\n\nconst ThemeProvider: FC<ThemeProviderProps> = ({ children }) => {\n  const [theme, setTheme] = useState(defaultTheme);\n  const toggleTheme = useCallback(() => {\n    setTheme(currentTheme => (currentTheme === defaultTheme ? projectorTheme : defaultTheme));\n  }, []);\n\n  return (\n    <MuiThemeProvider theme={theme}>\n      <ThemeContext.Provider value={toggleTheme}>{children}</ThemeContext.Provider>\n    </MuiThemeProvider>\n  );\n};\n\nexport default ThemeProvider;\n","import React, { FC, useState, MouseEvent } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCog } from '@fortawesome/free-solid-svg-icons';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport { useThemeToggle } from '../ThemeProvider';\n\nimport styles from './Header.module.scss';\n\ninterface HeaderProps {\n  logo: string;\n}\n\nconst Header: FC<HeaderProps> = (props: HeaderProps) => {\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const toggleTheme = useThemeToggle();\n\n  const handleClick = (event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = (): void => {\n    setAnchorEl(null);\n  };\n\n  const handleToggleTheme = (): void => {\n    toggleTheme();\n    handleClose();\n  };\n\n  return (\n    <header className={styles.header}>\n      <img src={props.logo} alt=\"logo\" />\n      <button onClick={handleClick} aria-controls=\"options-menu\" aria-haspopup=\"true\">\n        <FontAwesomeIcon icon={faCog} />\n      </button>\n      <Menu\n        id=\"options-menu\"\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}\n      >\n        <MenuItem onClick={handleToggleTheme}>Toggle Theme</MenuItem>\n      </Menu>\n    </header>\n  );\n};\n\nexport default Header;\n","import React, { FC, createContext, useContext, ReactNode } from 'react';\nimport { Patient } from 'fhir-objects';\ninterface PatientProviderProps {\n  children: ReactNode;\n  value: PatientContextInterface;\n}\n\ninterface PatientContextInterface {\n  patient: Patient | null;\n  setPatient: Function;\n}\n\nexport const PatientContext = createContext<PatientContextInterface>({\n  patient: null,\n  setPatient: (): void => {\n    return;\n  }\n});\n\nexport const PatientProvider: FC<PatientProviderProps> = ({ children, value }) => {\n  return value.patient == null ? (\n    <div>Loading...</div>\n  ) : (\n    <PatientContext.Provider value={value}>{children}</PatientContext.Provider>\n  );\n};\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const usePatient = (): PatientContextInterface => useContext(PatientContext)!;\n","import React, { FC, useMemo } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport clsx from 'clsx';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faUserCircle } from '@fortawesome/free-solid-svg-icons';\nimport { HumanName, Address } from 'fhir-objects';\n\nimport { usePatient } from '../PatientProvider';\nimport styles from './PatientSnapshot.module.scss';\n\nconst useStyles = makeStyles(\n  theme => ({\n    'patient-snapshot-list': {\n      color: theme.palette.text.primary\n    }\n  }),\n  { name: 'PatientSnapshot' }\n);\n\nconst getPatientName = (name: Array<HumanName> = []): string => {\n  const entry = name.find(n => n.use === 'official') || name[0];\n  return entry ? `${(entry.given || []).join(' ')} ${entry.family}` : 'No name';\n};\n\nconst getPatientAge = (birthDateString: string | undefined): number => {\n  if (!birthDateString) return 0;\n  const today = new Date();\n  const birthDate = new Date(birthDateString);\n  let age = today.getFullYear() - birthDate.getFullYear();\n  const m = today.getMonth() - birthDate.getMonth();\n  if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {\n    age--;\n  }\n  return age;\n};\n\nconst getPatientAddress = (address: Array<Address> = []): string => {\n  const entry = address[0];\n  return entry ? [entry.city, entry.state].filter(item => !!item).join(', ') : 'No Address';\n};\n\nconst PatientSnapshot: FC<{}> = () => {\n  const classes = useStyles();\n  const patient = usePatient().patient as fhir.Patient;\n  const name = useMemo(() => getPatientName(patient.name), [patient]);\n  const address = useMemo(() => getPatientAddress(patient.address), [patient]);\n  const age = useMemo(() => getPatientAge(patient.birthDate), [patient]);\n\n  return (\n    <div className={styles.patientSnapshot}>\n      <FontAwesomeIcon icon={faUserCircle} className={styles.patientSnapshot__photo} />\n\n      <div className={styles.patientSnapshot__info}>\n        <div className={styles.patientName}>{name}</div>\n\n        <ul className={clsx(styles.patientSnapshot__list, classes['patient-snapshot-list'])}>\n          <li>\n            DOB: {patient.birthDate} (Age: {age})\n          </li>\n          <li>Admin. Sex: {patient.gender}</li>\n          <li>Location: {address}</li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default PatientSnapshot;\n","import React, { FC, createContext, useContext, ReactNode } from 'react';\nimport { PathwayContextInterface } from 'pathways-model';\n\ninterface PathwayProviderProps {\n  children: ReactNode;\n  pathwayCtx: PathwayContextInterface;\n}\n\nexport const PathwayContext = createContext<PathwayContextInterface>({\n  evaluatedPathway: null,\n  setEvaluatedPathway: () => {\n    //do nothing\n  },\n  updateEvaluatedPathways: () => {\n    //do nothing\n  },\n  assignPathway: () => {\n    //do nothing\n  },\n  unassignPathway: () => {\n    //do nothing\n  }\n});\n\nexport const PathwayProvider: FC<PathwayProviderProps> = ({ children, pathwayCtx }) => {\n  return <PathwayContext.Provider value={pathwayCtx}>{children}</PathwayContext.Provider>;\n};\n\nexport const usePathwayContext = (): PathwayContextInterface => useContext(PathwayContext);\n","import React, { FC, createContext, useContext, ReactNode } from 'react';\n\ninterface UserContextInterface {\n  user: string;\n  setUser: Function;\n}\n\nexport const UserContext = createContext<UserContextInterface>({\n  user: '',\n  setUser: () => {\n    // do nothing\n  }\n});\n\ninterface UserProviderProps {\n  children: ReactNode;\n  value: UserContextInterface;\n}\nexport const UserProvider: FC<UserProviderProps> = ({ children, value }) => {\n  return <UserContext.Provider value={value}>{children}</UserContext.Provider>;\n};\n\nexport const useUser = (): UserContextInterface => useContext(UserContext);\n","import React, {\n  FC,\n  createContext,\n  useContext,\n  ReactNode,\n  useState,\n  SetStateAction,\n  Dispatch\n} from 'react';\nimport { usePathwayContext } from './PathwayProvider';\nimport { usePatient } from './PatientProvider';\nimport { getHumanName } from 'utils/fhirUtils';\nimport { useUser } from './UserProvider';\nexport interface Note {\n  patient: string;\n  date: string;\n  physician: string;\n  birthdate?: string;\n  mcodeElements: {\n    [key: string]: string;\n  };\n  pathway?: string;\n  node?: string;\n  status: string;\n  treatment?: string;\n  notes?: string;\n}\n\ninterface NoteDataProviderProps {\n  children: ReactNode;\n  date: Date;\n}\n\ninterface NoteContextProps {\n  note: Note | null;\n  setNote: Dispatch<SetStateAction<Note>> | (() => void);\n}\n\nexport const NoteContext = createContext<NoteContextProps>({\n  note: null,\n  setNote: () => {\n    // do nothing.\n  }\n});\n\nexport const NoteDataProvider: FC<NoteDataProviderProps> = ({ children, date }) => {\n  const patient = usePatient().patient as fhir.Patient;\n  const { user } = useUser();\n  const name = patient?.name ? getHumanName(patient.name) : '';\n  const [note, setNote] = useState<Note>({\n    patient: name,\n    date: date.toDateString(),\n    physician: user,\n    birthdate: patient?.birthDate || '',\n    mcodeElements: {},\n    pathway: usePathwayContext().evaluatedPathway?.pathway.name,\n    status: 'Pending'\n  });\n\n  return <NoteContext.Provider value={{ note, setNote }}>{children}</NoteContext.Provider>;\n};\n\nexport const useNote = (): NoteContextProps => useContext(NoteContext);\n\nexport const toString = (note: Note): string => {\n  let mcodeElements = '';\n  Object.keys(note.mcodeElements).forEach(element => {\n    mcodeElements += `${element}: ${note.mcodeElements[element]}\\n`;\n  });\n  const noteString = `Date: ${note.date}\\n\nPatient: ${note.patient}\\n\nBirthdate: ${note.birthdate}\\n\nPhysician: ${note.physician}\\n\n${mcodeElements}\nPathway: ${note.pathway}\\n\nNode: ${note.node}\\n\nStatus: ${note.status}\\n\nTreatment: ${note.treatment}\\n\nNotes: ${note.notes}`;\n  return noteString;\n};\n","import { ActionNode, EvaluatedPathway, Pathway } from 'pathways-model';\nimport { Note, toString } from 'components/NoteDataProvider';\nimport {\n  Patient,\n  DomainResource,\n  HumanName,\n  DocumentReference,\n  Observation,\n  ServiceRequest,\n  MedicationRequest,\n  CarePlan\n} from 'fhir-objects';\nimport { R4 } from '@ahryman40k/ts-fhir-types';\nimport { v1 } from 'uuid';\nimport { McodeElements } from 'mcode';\nimport shortid from 'shortid';\n\n// translates pathway recommendation resource into suitable FHIR resource\nexport function translatePathwayRecommendation(\n  pathwayResource: MedicationRequest | ServiceRequest | CarePlan,\n  patientId: string\n): MedicationRequest | ServiceRequest | CarePlan {\n  const { resourceType } = pathwayResource;\n  const resourceProperties = {\n    id: v1(),\n    resourceType,\n    intent: 'order',\n    subject: { reference: `Patient/${patientId}` },\n    status: 'active',\n    authoredOn: new Date().toISOString(),\n    meta: {\n      lastUpdated: new Date().toISOString()\n    }\n  };\n\n  switch (resourceType) {\n    case 'ServiceRequest': {\n      const { code } = pathwayResource as ServiceRequest;\n      return {\n        ...resourceProperties,\n        code\n      } as ServiceRequest;\n    }\n    case 'MedicationRequest': {\n      const { medicationCodeableConcept } = pathwayResource as MedicationRequest;\n      return {\n        ...resourceProperties,\n        medicationCodeableConcept\n      } as MedicationRequest;\n    }\n    case 'CarePlan': {\n      const { title } = pathwayResource as CarePlan;\n      return {\n        ...resourceProperties,\n        title\n      } as CarePlan;\n    }\n    default: {\n      throw Error(`Translation for ${resourceType} not implemented.`);\n    }\n  }\n}\n\nexport function getHumanName(person: HumanName[]): string {\n  let name = '';\n  if (Array.isArray(person)) {\n    name = [\n      person[0]?.prefix?.join(' '),\n      person[0]?.given?.join(' '),\n      person[0]?.family,\n      person[0]?.suffix?.join(' ')\n    ].join(' ');\n  }\n  return name;\n}\n\nexport function createDocumentReference(data: string, patient: Patient): DocumentReference {\n  return {\n    resourceType: 'DocumentReference',\n    id: v1(),\n    meta: {\n      lastUpdated: getCurrentTime()\n    },\n    status: 'current',\n    subject: { reference: `Patient/${patient.id}` },\n    content: [\n      {\n        attachment: {\n          data: btoa(data), // Base 64 encoded data\n          contentType: 'text/plain'\n        }\n      }\n    ],\n    // type and indexed are required in STU3 DocumentReference but not in R4\n    type: {\n      coding: [\n        {\n          system: 'http://loinc.org',\n          code: '34108-1',\n          display: 'Outpatient Note'\n        }\n      ]\n    },\n    indexed: ''\n  };\n}\n\nexport function createActionDocumentReference(\n  data: string,\n  labelOrCondition: string,\n  patient: Patient\n): DocumentReference {\n  const documentReference = createDocumentReference(data, patient);\n  return {\n    ...documentReference,\n    identifier: [\n      {\n        system: 'pathways.documentreference',\n        value: btoa(labelOrCondition)\n      }\n    ]\n  };\n}\n\nexport function createNoteContent(\n  note: Note,\n  patientRecords: DomainResource[],\n  status: string,\n  notes: string,\n  actionNode?: ActionNode\n): string {\n  note.status = status;\n  note.notes = notes;\n  if (actionNode) {\n    note.treatment = actionNode.action.description;\n    note.node = actionNode.label;\n  }\n\n  const tnm: string[] = ['', '', ''];\n  patientRecords.forEach(record => {\n    // TODO: should use code bindings over\n    // profile names.\n    if (record.meta?.profile && record.meta.profile.length) {\n      const elements = [\n        'TNMClinicalPrimaryTumorCategory',\n        'TNMClinicalRegionalNodesCategory',\n        'TNMClinicalDistantMetastasesCategory'\n      ];\n\n      const profile = record.meta.profile[0];\n      if (record.resourceType === 'Observation') {\n        if (profile.includes('TumorMarkerTest') && record.resourceType === 'Observation') {\n          const obs = record as Observation;\n          const value = obs.valueCodeableConcept?.text;\n          const name = obs.code.text;\n          if (value && name) {\n            note.mcodeElements[name] = value;\n          }\n        } else if (\n          elements.some(value => {\n            return profile.includes(value);\n          })\n        ) {\n          const index = elements.findIndex(value => {\n            return profile.includes(value);\n          });\n          if (index > -1) {\n            const obs = record as Observation;\n            const value = obs.valueCodeableConcept?.text;\n            if (value) {\n              tnm[index] = value;\n            }\n          }\n        }\n      }\n    }\n  });\n\n  note.mcodeElements['Clinical TNM'] = tnm.join(' ');\n  return toString(note);\n}\n\nfunction getCurrentTime(): string {\n  const now = new Date();\n  return (\n    now.getFullYear() +\n    '-' +\n    withLeadingZero(now.getMonth()) +\n    '-' +\n    withLeadingZero(now.getDay()) +\n    'T' +\n    withLeadingZero(now.getUTCHours()) +\n    ':' +\n    withLeadingZero(now.getUTCMinutes()) +\n    ':' +\n    withLeadingZero(now.getUTCSeconds()) +\n    '.' +\n    now.getUTCMilliseconds() +\n    '+00:00'\n  );\n}\n\nfunction withLeadingZero(n: number): string {\n  return n < 10 ? '0' + n : n.toString();\n}\n\nexport function createCarePlan(title: string, patient: Patient): CarePlan {\n  return {\n    title,\n    resourceType: 'CarePlan',\n    id: shortid.generate(),\n    text: {\n      status: R4.NarrativeStatusKind._generated,\n      div: `<div> Assignment of patient to pathway ${title} </div>`\n    },\n    status: 'active',\n    intent: 'plan',\n    category: [\n      {\n        coding: [\n          {\n            system: 'http://hl7.org/fhir/us/core/CodeSystem/careplan-category',\n            code: 'assess-plan'\n          }\n        ]\n      }\n    ],\n    subject: { reference: `Patient/${patient.id}` }\n  };\n}\n\nexport function getAssignedPathways(\n  patientRecords: DomainResource[],\n  evaluatedPathways: EvaluatedPathway[]\n): string[] {\n  // Get all active CarePlan resource titles\n  const carePlanTitles = (patientRecords.filter(r => r.resourceType === 'CarePlan') as CarePlan[])\n    .filter(r => r.status === 'active')\n    .map(r => r.title);\n\n  // Check to see if any of the pathway names are in carePlanTitles\n  return evaluatedPathways.map(p => p.pathway.name).filter(n => carePlanTitles.includes(n));\n}\n\nexport function pathwayIsAssigned(\n  patientRecords: DomainResource[],\n  pathway: Pathway | undefined\n): boolean {\n  if (!pathway) return false;\n\n  // Get all active CarePlan resource titles\n  const carePlanTitles = (patientRecords.filter(r => r.resourceType === 'CarePlan') as CarePlan[])\n    .filter(r => r.status === 'active')\n    .map(r => r.title);\n\n  return carePlanTitles.includes(pathway.name);\n}\n\nexport function getTNM(mcodeElements: McodeElements): string {\n  const tnm = [\n    mcodeElements['Tumor Category']?.split(' ')[0],\n    mcodeElements['Node Category']?.split(' ')[0],\n    mcodeElements['Metastases Category']?.split(' ')[0]\n  ].join(' ');\n  return tnm === '   ' ? 'Unknown' : tnm;\n}\n\n/**\n * Helper function to retrieve DocumentReference note if one exists.\n * @param condition - the transition condition description for the note\n * @param resources - list of patient resources\n * @return DocumentReference for the transition condition or null if none found\n */\nexport function retrieveNote(\n  condition: string,\n  resources: DomainResource[]\n): DocumentReference | null {\n  const documentReference = resources.find(resource => {\n    if (resource.resourceType !== 'DocumentReference') return false;\n    const documentReference = resource as DocumentReference;\n    if (documentReference.identifier === undefined) return false;\n    for (const identifier of documentReference.identifier) {\n      if (\n        identifier.system === 'pathways.documentreference' &&\n        identifier.value === btoa(condition)\n      )\n        return true;\n    }\n    return false;\n  });\n\n  if (!documentReference) return null;\n\n  return documentReference as DocumentReference;\n}\n","import React, { FC, createContext, useContext, ReactNode } from 'react';\nimport { DomainResource } from 'fhir-objects';\nimport { McodeElements } from 'mcode';\ninterface PatientRecordsProviderProps {\n  children: ReactNode;\n  value: PatientRecordsContextInterface;\n}\n\ninterface PatientRecordsContextInterface {\n  patientRecords: DomainResource[];\n  setPatientRecords: Function;\n  evaluatePath: boolean;\n  setEvaluatePath: (value: boolean) => void;\n  mcodeRecords: McodeElements;\n  setMcodeRecords: (value: DomainResource[]) => void;\n}\n\nexport const PatientRecordsContext = createContext<PatientRecordsContextInterface>({\n  patientRecords: [],\n  setPatientRecords: (): void => {\n    return;\n  },\n  evaluatePath: true,\n  setEvaluatePath: (): void => {\n    return;\n  },\n  mcodeRecords: {},\n  setMcodeRecords: (): void => {\n    return;\n  }\n});\n\nexport const PatientRecordsProvider: FC<PatientRecordsProviderProps> = ({ children, value }) => {\n  return <PatientRecordsContext.Provider value={value}>{children}</PatientRecordsContext.Provider>;\n};\n\nexport const usePatientRecords = (): PatientRecordsContextInterface =>\n  useContext(PatientRecordsContext);\n","import React, { FC, useCallback } from 'react';\nimport Select from 'react-select';\n\nimport styles from './DropDown.module.scss';\nimport { Option } from 'option';\nimport { pathwayIsAssigned } from 'utils/fhirUtils';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport { Button } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faThList, faCheckCircle, faTimesCircle } from '@fortawesome/free-solid-svg-icons';\nimport { usePathwayContext } from 'components/PathwayProvider';\n\ninterface Props {\n  label?: string;\n  id: string;\n  visible: boolean;\n  options: Array<Option>;\n  onChange?: (value: Option | ReadonlyArray<Option> | null) => void;\n  selectedValue: Option | ReadonlyArray<Option> | null;\n  setSelectPathway: (flag: boolean) => void;\n}\n\nconst DropDown: FC<Props> = ({\n  options,\n  label,\n  id,\n  visible,\n  onChange,\n  selectedValue,\n  setSelectPathway\n}: Props) => {\n  const { patientRecords } = usePatientRecords();\n  const { evaluatedPathway, assignPathway, unassignPathway } = usePathwayContext();\n  const onChangeCallback = useCallback(\n    (value: Option | ReadonlyArray<Option> | null | undefined) => {\n      if (onChange) onChange(value == null ? null : value);\n    },\n    [onChange]\n  );\n\n  const assigned = pathwayIsAssigned(patientRecords, evaluatedPathway?.pathway);\n\n  const formatOptionLabel = (option: Readonly<Option>): object => (\n    <>\n      {option.label}\n      {pathwayIsAssigned(patientRecords, option.value.pathway) && (\n        <FontAwesomeIcon icon={faCheckCircle} className={styles.check} />\n      )}\n    </>\n  );\n\n  if (visible)\n    return (\n      <div className={styles.dropdown}>\n        <div>\n          <label htmlFor={id}>{label}</label>\n          <Button\n            onClick={(): void => {\n              setSelectPathway(true);\n            }}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<FontAwesomeIcon icon={faThList} />}\n          >\n            Explore\n          </Button>\n          <Button\n            onClick={(): void => {\n              if (evaluatedPathway?.pathway) {\n                assigned\n                  ? unassignPathway(evaluatedPathway.pathway.name)\n                  : assignPathway(evaluatedPathway.pathway.name);\n              } else {\n                alert('Unable to perform action. No pathway is selected.');\n              }\n            }}\n            variant=\"contained\"\n            color={assigned ? 'secondary' : 'primary'}\n            startIcon={<FontAwesomeIcon icon={assigned ? faTimesCircle : faCheckCircle} />}\n          >\n            {assigned ? 'Unassign' : 'Assign'}\n          </Button>\n        </div>\n        <Select\n          classNamePrefix=\"DropDown\"\n          inputId={id}\n          value={selectedValue}\n          onChange={onChangeCallback}\n          options={options}\n          aria-label={label}\n          formatOptionLabel={formatOptionLabel}\n        />\n      </div>\n    );\n  else return <div></div>;\n};\n\nexport default DropDown;\n","import React, { FC } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport clsx from 'clsx';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faChevronLeft } from '@fortawesome/free-solid-svg-icons';\n\nimport PatientSnapshot from 'components/PatientSnapshot';\nimport DropDown from 'components/DropDown';\nimport styles from './Navigation.module.scss';\nimport { EvaluatedPathway } from 'pathways-model';\nimport { Option } from 'option';\nimport { usePathwayContext } from 'components/PathwayProvider';\n\nconst useStyles = makeStyles(\n  theme => ({\n    navigation: {\n      backgroundColor: theme.palette.background.default,\n      color: theme.palette.text.primary\n    }\n  }),\n  { name: 'Navigation' }\n);\n\ninterface Props {\n  evaluatedPathways: EvaluatedPathway[];\n  selectPathway: boolean;\n  setSelectPathway: (flag: boolean) => void;\n  onBack?: () => void;\n}\n\nconst Navigation: FC<Props> = ({ evaluatedPathways, selectPathway, setSelectPathway, onBack }) => {\n  const classes = useStyles();\n  const pathwayCtx = usePathwayContext();\n  const pathway = pathwayCtx.evaluatedPathway?.pathway;\n  const value =\n    pathway === undefined ? null : { label: pathway.name, value: pathwayCtx.evaluatedPathway };\n\n  const onChangeHandler = (pathwayOption: Option | ReadonlyArray<Option> | null): void => {\n    if (pathwayOption !== null && 'value' in pathwayOption) {\n      pathwayCtx.setEvaluatedPathway(pathwayOption.value);\n    }\n  };\n\n  const pathwayOptions = evaluatedPathways.map(evaluatedPathway => ({\n    label: evaluatedPathway.pathway.name,\n    value: evaluatedPathway\n  }));\n\n  return (\n    <nav className={clsx(styles.navigation, classes.navigation)}>\n      <div className={styles.navigation__leftPanel}>\n        {onBack && (\n          <FontAwesomeIcon\n            icon={faChevronLeft}\n            className={styles.navigation__back}\n            onClick={onBack}\n          />\n        )}\n\n        <PatientSnapshot />\n      </div>\n\n      <div className={styles.navigation__rightPanel}>\n        <DropDown\n          label=\"Pathway:\"\n          id=\"patient-view\"\n          visible={!selectPathway}\n          options={pathwayOptions}\n          selectedValue={value}\n          setSelectPathway={setSelectPathway}\n          onChange={onChangeHandler}\n        />\n      </div>\n    </nav>\n  );\n};\n\nexport default Navigation;\n","const ALL_RESOURCES_PATIENT_REFERENCE = [\n  'ReferralRequest:patient',\n  'DocumentManifest:patient',\n  'Goal:patient',\n  'Consent:patient',\n  'DocumentReference:patient',\n  'ImagingManifest:patient',\n  'RiskAssessment:patient',\n  'CareTeam:patient',\n  'ImagingStudy:patient',\n  'FamilyMemberHistory:patient',\n  'Encounter:patient',\n  'DeviceRequest:patient',\n  'AllergyIntolerance:patient',\n  'CarePlan:patient',\n  'EpisodeOfCare:patient',\n  'Procedure:patient',\n  'List:patient',\n  'Immunization:patient',\n  'VisionPrescription:patient',\n  'ProcedureRequest:patient',\n  'Flag:patient',\n  'Observation:patient',\n  'DiagnosticReport:patient',\n  'NutritionOrder:patient',\n  'Condition:patient',\n  'Composition:patient',\n  'DetectedIssue:patient',\n  'SupplyDelivery:patient',\n  'ClinicalImpression:patient',\n  'DeviceUseStatement:patient',\n  'Task:subject',\n  'Task:requester',\n  'Task:patient',\n  'Task:owner',\n  'Task:focus',\n  'Task:based-on',\n  'SupplyRequest:requester',\n  'Specimen:subject',\n  'Specimen:patient',\n  'ServiceDefinition:successor',\n  'ServiceDefinition:predecessor',\n  'ServiceDefinition:depends-on',\n  'ServiceDefinition:derived-from',\n  'ServiceDefinition:composed-of',\n  'Sequence:patient',\n  'Schedule:actor',\n  'RiskAssessment:subject',\n  'ResearchSubject:patient',\n  'ResearchSubject:individual',\n  'RequestGroup:subject',\n  'RequestGroup:participant',\n  'RequestGroup:patient',\n  'RequestGroup:definition',\n  'RelatedPerson:patient',\n  'ReferralRequest:subject',\n  'ReferralRequest:requester',\n  'QuestionnaireResponse:subject',\n  'QuestionnaireResponse:source',\n  'QuestionnaireResponse:patient',\n  'QuestionnaireResponse:author',\n  'Provenance:target',\n  'Provenance:entity-ref',\n  'Provenance:patient',\n  'Provenance:agent',\n  'ProcessResponse:request',\n  'ProcedureRequest:subject',\n  'ProcedureRequest:replaces',\n  'ProcedureRequest:performer',\n  'ProcedureRequest:based-on',\n  'Procedure:subject',\n  'Procedure:performer',\n  'PlanDefinition:successor',\n  'PlanDefinition:predecessor',\n  'PlanDefinition:derived-from',\n  'PlanDefinition:depends-on',\n  'PlanDefinition:composed-of',\n  'Person:patient',\n  'Person:link',\n  'PaymentNotice:response',\n  'PaymentNotice:request',\n  'Patient:link',\n  'Observation:subject',\n  'Observation:performer',\n  'MessageHeader:focus',\n  'MedicationStatement:source',\n  'MedicationStatement:subject',\n  'MedicationRequest:subject',\n  'MedicationRequest:requester',\n  'MedicationDispense:subject',\n  'MedicationDispense:receiver',\n  'MedicationDispense:performer',\n  'MedicationAdministration:subject',\n  'MedicationRequest:patient',\n  'MedicationAdministration:patient',\n  'MedicationStatement:patient',\n  'MedicationDispense:patient',\n  'MedicationAdministration:performer',\n  'Media:subject',\n  'Media:patient',\n  'MeasureReport:patient',\n  'Measure:successor',\n  'Measure:predecessor',\n  'Measure:derived-from',\n  'Measure:depends-on',\n  'Measure:composed-of',\n  'List:subject',\n  'List:item',\n  'List:source',\n  'Library:successor',\n  'Library:predecessor',\n  'Library:derived-from',\n  'Library:composed-of',\n  'Library:depends-on',\n  'ImplementationGuide:resource',\n  'ImmunizationRecommendation:patient',\n  'ImagingManifest:author',\n  'GuidanceResponse:subject',\n  'GuidanceResponse:patient',\n  'Group:member',\n  'Goal:subject',\n  'Flag:subject',\n  'Flag:author',\n  'ExplanationOfBenefit:patient',\n  'ExplanationOfBenefit:payee',\n  'EnrollmentRequest:subject',\n  'EnrollmentRequest:patient',\n  'Encounter:subject',\n  'EligibilityRequest:patient',\n  'DocumentReference:subject',\n  'DocumentReference:related-ref',\n  'DocumentReference:author',\n  'DocumentManifest:subject',\n  'DocumentManifest:related-ref',\n  'DocumentManifest:content-ref',\n  'DocumentManifest:recipient',\n  'DiagnosticReport:subject',\n  'DocumentManifest:author',\n  'DeviceUseStatement:subject',\n  'DeviceRequest:subject',\n  'DeviceRequest:priorrequest',\n  'DeviceRequest:performer',\n  'DeviceRequest:based-on',\n  'Device:patient',\n  'DetectedIssue:implicated',\n  'Coverage:subscriber',\n  'Coverage:policy-holder',\n  'Coverage:payor',\n  'Contract:term-topic',\n  'Coverage:beneficiary',\n  'Contract:subject',\n  'Contract:signer',\n  'Contract:patient',\n  'Contract:agent',\n  'Consent:data',\n  'Consent:consentor',\n  'Consent:actor',\n  'Condition:subject',\n  'Condition:evidence-detail',\n  'Condition:asserter',\n  'Composition:subject',\n  'Composition:entry',\n  'Composition:author',\n  'Composition:attester',\n  'CommunicationRequest:subject',\n  'CommunicationRequest:sender',\n  'CommunicationRequest:requester',\n  'CommunicationRequest:recipient',\n  'CommunicationRequest:patient',\n  'CommunicationRequest:based-on',\n  'Communication:subject',\n  'Communication:recipient',\n  'Communication:sender',\n  'Communication:patient',\n  'Communication:part-of',\n  'Communication:based-on',\n  'ClinicalImpression:subject',\n  'ClaimResponse:patient',\n  'Claim:payee',\n  'Claim:patient',\n  'ChargeItem:subject',\n  'ChargeItem:patient',\n  'ChargeItem:participant-actor',\n  'ChargeItem:enterer',\n  'CareTeam:subject',\n  'CareTeam:participant',\n  'CarePlan:performer',\n  'CarePlan:subject',\n  'BodySite:patient',\n  'Basic:subject',\n  'Basic:patient',\n  'Basic:author',\n  'AuditEvent:patient',\n  'AuditEvent:entity',\n  'AuditEvent:agent',\n  'AppointmentResponse:patient',\n  'AppointmentResponse:actor',\n  'Appointment:patient',\n  'Appointment:actor',\n  'AllergyIntolerance:recorder',\n  'AllergyIntolerance:asserter',\n  'AdverseEvent:subject',\n  'AdverseEvent:recorder',\n  'ActivityDefinition:successor',\n  'ActivityDefinition:predecessor',\n  'ActivityDefinition:depends-on',\n  'ActivityDefinition:derived-from',\n  'ActivityDefinition:composed-of',\n  'Account:subject',\n  'Account:patient'\n];\n\nexport { ALL_RESOURCES_PATIENT_REFERENCE };\n","import { ALL_RESOURCES_PATIENT_REFERENCE } from './patient';\n\nimport { mappers } from 'fhir-mapper';\nimport config from './ConfigManager';\n\nconst mapperName = config.get('mapper');\nconst MapperClass = mappers[mapperName];\nconst mapperInstance = MapperClass ? new MapperClass() : null;\n\nconst applyMapping = (bundle) => {\n  if (mapperInstance && bundle)\n  {\n    bundle = mapperInstance.execute(bundle);\n  }\n  return bundle;\n}\n\n/**\n * There are slight discrepencies between the $everything, revinclude, and manual methods that affect the resources that might be returned\n * @param {Object} client - the fhir client\n */\nfunction getPatientRecord(client) {\n  return client.request(`/metadata`).then(statement => {\n    if (\n      statement.rest[0].operation.find(\n        e => (e.definition.reference || e.definition) === 'OperationDefinition/Patient--everything'\n      )\n    ) {\n      // supports patient everything\n      return getEverything(client).then(bundle => applyMapping(bundle));\n    } else {\n      console.log('Cannot use $everything, using reverse includes instead');\n      const supportedResources = [];\n      let revIncludeResources = [];\n      statement.rest[0].resource.forEach(resource => {\n        if (resource.type === 'Patient') {\n          if (resource.searchRevInclude) {\n            revIncludeResources = resource.searchRevInclude;\n          }\n        } else if (resource.searchInclude) {\n          const filters = resource.searchInclude.filter(target => {\n            return target === `${resource.type}:patient` || target === `${resource.type}:subject`;\n          });\n          if (filters.length > 0) {\n            supportedResources.push(filters[0]);\n          }\n        } else if (resource.searchParam) {\n          const filters = resource.searchParams.filter(target => {\n            return target.name === `patient` || target.name === `subject`;\n          });\n          if (filters.length > 0) {\n            supportedResources.push(`${resource.type}:${filters[0].name}`);\n          }\n        }\n      });\n      if (revIncludeResources.length > 0) {\n        return getEverythingRevInclude(client, revIncludeResources, getEverythingManually).then(bundle => applyMapping(bundle));\n      } else if (supportedResources.length > 0) {\n        return getEverythingRevInclude(client, supportedResources, getEverythingManually).then(bundle => applyMapping(bundle));\n      } else {\n        console.log('Cannot use reverse includes, retrieving all resources manually from predefined list');\n        return getEverythingManually(client, ALL_RESOURCES_PATIENT_REFERENCE).then(bundle => applyMapping(bundle));\n      }\n    }\n  });\n}\n\n/**\n * Uses the $everything operation.  The server takes care of constructing the bundle that gets returned, so\n * it is generally not possible to know how it is deciding what resources to send.\n */\nfunction getEverything(client) {\n  return client.request(`/Patient/${client.patient.id}/$everything`, { flat: true, pageLimit: 0 }).then(bundle => {\n    return bundle;\n  });\n}\n\n/**\n * Uses regular FHIR search queries on every resource that is supported and can refer to a patient.\n * Which resources it queries is dependent on info available in the Capability Statement, and\n * it only provides a one layer deep search, so the results might be different from $everything.\n */\nfunction getEverythingManually(client, supportedResources) {\n  supportedResources.push('Patient:_id');\n  const requests = [];\n  supportedResources.forEach(resource => {\n    resource = resource.split(':');\n    const request = client\n      .request(`${resource[0]}?${resource[1]}=${client.patient.id}`, { flat: true, pageLimit: 0 })\n      .then(result => {\n        if (result.length > 0) {\n          return result;\n        }\n      })\n      .catch(error => {\n        console.log(`failed to fetch ${resource}`);\n        console.error(error);\n      });\n    requests.push(request);\n  });\n\n  return Promise.all(requests).then(results => {\n    const bundle = results\n      .filter(x => {\n        return x;\n      })\n      .flat();\n    return bundle;\n  });\n}\n\n/**\n * Uses the _revinclude FHIR search parameter to request the patient resource and any resource that refers to it.\n * The list of resources it checks is retrieved from the Capability Statement.  It is slightly better than the manual\n * method since it does everything in one request.\n */\nfunction getEverythingRevInclude(client, supportedResources, onError) {\n  const query = supportedResources.join('&_revinclude=');\n  return client\n    .request(`/Patient?_id=${client.patient.id}&_revinclude=${query}`, { flat: true })\n    .then(result => {\n      return result;\n    })\n    .catch(error => {\n      console.log('Reverse Include query failed, manually fetching resources instead.');\n      console.error(error);\n      onError(client, supportedResources);\n    });\n}\n\nexport { getPatientRecord };\n","import React, { FC, createContext, useContext, ReactNode } from 'react';\nimport { PathwaysClient } from 'pathways-client';\n\ninterface FHIRClientProviderProps {\n  client: PathwaysClient; // TODO: fhirclient.Client\n  children: ReactNode;\n}\n\nexport const FHIRClientContext = createContext({ patient: {} });\n\nexport const FHIRClientProvider: FC<FHIRClientProviderProps> = ({ client, children }) => (\n  <FHIRClientContext.Provider value={client}>{children}</FHIRClientContext.Provider>\n);\n\nexport const useFHIRClient = (): PathwaysClient => useContext(FHIRClientContext);\n","import { Pathway } from 'pathways-model';\n\nexport interface CqlObject {\n  main: string;\n  libraries: Library;\n}\n\nexport interface Library {\n  [name: string]: string; // should probably have an object for expected ELM structure.\n}\n\n/**\n * Function to extract the CQL code from the pathway and build\n * the CQL code to execute\n * @param pathway - the JSON object of the entire pathway\n * @return a string of the CQL code for the navigational nodes in the pathway\n */\nexport function extractCQL(pathway: Pathway): Promise<CqlObject> {\n  // TODO: this no longer needs to be async,\n  //  but it's easier to just wrap it in a promise than change what calls it\n  return new Promise((resolve, reject) => {\n    // we no longer need to construct a new library here,\n    // as the builder constructed one for us,\n    // and it's the first entry in pathway.library\n    // subsequent libraries are dependencies\n    const libraries: { [k: string]: string } = {};\n\n    pathway.library.slice(1).forEach(l => {\n      const n = libName(l);\n      libraries[n] = l;\n    });\n\n    resolve({ main: pathway.library[0], libraries });\n  });\n}\n\nexport function libName(library: string): string {\n  // assumption is all CQL libraries will start with a line like this:\n  // library CMS153_CQM version '2'\n  // or possibly some comments or blank lines first\n  // TODO: can library names be quoted and contain spaces?\n  // TODO: are multiple spaces allowed?\n  const lines = library.split('\\n');\n  const libraryLine = lines.find(l => l.trim().startsWith('library '));\n\n  if (!libraryLine) {\n    throw new Error(`cql does not contain a library name: ${library}`);\n  }\n\n  const trimmed = libraryLine.trim(); // juuust in case\n\n  const firstSpace = trimmed.indexOf(' ');\n  const secondSpace = trimmed.indexOf(' ', firstSpace + 1);\n\n  // +1 so we don't actually include that first space in the substring\n  let name = trimmed.substring(firstSpace + 1, secondSpace);\n\n  if (name.startsWith('\"')) {\n    // slice is like substring, but negative numbers count from the end\n    name = name.slice(1, -1);\n  }\n  return name;\n}\n","// IMPORTANT: anything with /g is stateful, meaning these could fail in weird ways\n// if they use the /g global flag\n// we should review these\n\n// sample header= \"multipart/form-data;boundary=Boundary_1\"\n// get the part after \"boundary=\" and before any subsequent ;\nexport const extractMultipartBoundary = /.*;boundary=(Boundary.*);?.*/;\n\nexport const extractMultipartFileName = /Content-Disposition: form-data; name=\"([^\"]+)\"/;\n\n// eveything between { } including newlines. [^] is like . but matches newline\nexport const extractJSONContent = /(\\{[^]*\\})/;\n","// External CQL -> ELM service\nimport { CqlObject } from './cql-extractor';\nimport config from 'utils/ConfigManager';\nimport {\n  extractJSONContent,\n  extractMultipartBoundary,\n  extractMultipartFileName\n} from 'utils/regexes';\n\nconst url = config.get('cqlToElmWebserviceUrl');\n\nexport interface ElmObject {\n  main: object;\n  libraries: {\n    [key: string]: object;\n  };\n}\n\n/**\n * Function that requests web_service to convert the cql into elm.\n * @param cql - cql file that is the input to the function.\n * @return The resulting elm translation of the cql file.\n */\nexport default function convertCQL(cql: CqlObject): Promise<ElmObject> {\n  // Connect to web service\n  const formdata = new FormData();\n  Object.keys(cql.libraries).forEach((key, i) => {\n    formdata.append(`${key}`, cql.libraries[key]);\n  });\n\n  formdata.append('main', cql.main);\n  return fetch(url, {\n    method: 'POST',\n    body: formdata\n  }).then(elm => {\n    const header = elm.headers.get('content-type');\n    let boundary = '';\n    if (header) {\n      // sample header= \"multipart/form-data;boundary=Boundary_1\"\n      const result = extractMultipartBoundary.exec(header);\n      boundary = result ? `--${result[1]}` : '';\n    }\n    const obj: ElmObject = { main: {}, libraries: {} };\n    return elm.text().then(text => {\n      const elms = text.split(boundary).reduce((oldArray, line, i) => {\n        const body = extractJSONContent.exec(line);\n        if (body) {\n          const elmName = extractMultipartFileName.exec(line);\n          if (elmName && elmName[1] === 'main') {\n            oldArray[elmName[1]] = JSON.parse(body[1]);\n          } else if (elmName) {\n            oldArray.libraries[elmName[1]] = JSON.parse(body[1]);\n          }\n        }\n        return oldArray;\n      }, obj);\n\n      return elms;\n    });\n  });\n}\n\nexport function convertBasicCQL(cql: string): Promise<object> {\n  // Connect to web service\n\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/cql',\n      Accept: 'application/elm+json'\n    },\n    body: cql\n  }).then(elm => elm.json());\n}\n","/* eslint-disable max-len */\nimport { ElmResults } from 'pathways-model';\nimport { Library, Executor, Repository } from 'cql-execution';\nimport { PatientSource } from 'cql-exec-fhir';\nimport { Bundle } from 'fhir-objects';\n/**\n * Engine function that takes in a patient file (JSON) and an ELM file, running the patient against the ELM file\n * @param patientRecord - FHIR bundle containing patient's record\n * @param elm - ELM structure (previosuly converted from CQL) on which the patient will be run.\n * @return returns a JSON object which is the result of analyzing the patient against the elm file\n */\nexport default function executeElm(\n  patientRecord: Bundle,\n  elm: object,\n  libraries?: object\n): ElmResults {\n  let lib;\n  if (libraries) {\n    lib = new Library(elm, new Repository(libraries));\n  } else {\n    lib = new Library(elm);\n  }\n\n  const executor = new Executor(lib);\n  const psource = new PatientSource.FHIRv401(patientRecord);\n  psource.loadBundles(patientRecord);\n  const result = executor.exec(psource);\n  return result;\n}\n","/* eslint-disable guard-for-in */\n/* eslint-disable max-len */\n\nimport {\n  Pathway,\n  PathwayResults,\n  PatientData,\n  PreconditionResult,\n  DocumentationResource,\n  PathwayNode,\n  PreconditionResultItem,\n  Documentation\n} from 'pathways-model';\nimport { DocumentReference, DomainResource } from 'fhir-objects';\nimport { retrieveNote } from 'utils/fhirUtils';\n\ninterface NodeData {\n  documentation: Documentation;\n  nextNodes: string[];\n  status: string;\n}\n\n/**\n * Engine function to take in the ELM patient results and output data relating to the patient's pathway\n * @param pathway - the entire pathway\n * @param patientData - the data on the patient from a CQL execution. Note this is a single patient not the entire patientResults object\n * @return PathwayResults describing\n */\nexport function pathwayData(\n  pathway: Pathway,\n  patientData: PatientData,\n  resources: DomainResource[]\n): PathwayResults {\n  const startNode = 'Start';\n  let currentNodes: string[] = [];\n  let nextNodes: string[] = [startNode];\n  const documentation: { [key: string]: Documentation } = {};\n\n  // think of this function like a proof by induction:\n  // - basis: we start at the start node\n  // - recursive: we know the current node(s) we are on, find the next ones\n  // if there are next ones, repeat the process with those, until we don't find any next steps\n  // then our \"current node(s)\" at the end, are the current step shown to the user\n\n  do {\n    currentNodes = nextNodes;\n    nextNodes = [];\n    // this should work whether there are 1 or many current nodes\n    // find the first one that is complete or in-progress\n    // and get the next nodes from that\n    // if there are none, then we stick with the current nodes\n    for (const nodeKey of currentNodes) {\n      const currentNode = pathway.nodes[nodeKey];\n      const [status, resource] = getStatusAndResource(currentNode, patientData, resources);\n      if (status === 'completed' || resource) {\n        documentation[nodeKey] = { node: nodeKey, onPath: true };\n        if (resource) {\n          const dr = documentation[nodeKey] as DocumentationResource;\n          dr.resourceType = resource.resourceType ?? '';\n          dr.id = resource.id ?? ''; // these should never be null in practice\n\n          dr.status = 'status' in resource ? resource['status'] : 'unknown'; // TODO\n          // finally get the actual resource;\n          // until here `resource` is just a \"stub\" of id/resourceType\n          dr.resource = retrieveResource(dr, resources);\n        }\n\n        if (status === 'completed') {\n          nextNodes = getNextNodes(currentNode, patientData, resources, resource);\n        } else {\n          currentNodes = [nodeKey];\n          nextNodes = [];\n        }\n\n        break;\n      }\n    }\n  } while (nextNodes.length !== 0);\n\n  // do a second pass of any nodes without documentation to see if they are complete\n  getNonPathDocumentation(pathway, patientData, resources, documentation);\n\n  return {\n    patientId: patientData.Patient.id.value,\n    currentNodes,\n    documentation\n  };\n}\n\n/**\n * Find the status of the given node, and a relevant resource for documentation.\n * The returned resource may be a Request (such as MedicationRequest),\n * an Action (such as Procedure), or a note (DocumentReference).\n * @param currentNode - the given node in the pathway to check\n * @param patientData - result of evaluating pathway ELM against the patient\n * @param resources - the patient's entire FHIR record\n */\nfunction getStatusAndResource(\n  currentNode: PathwayNode,\n  patientData: PatientData,\n  resources: DomainResource[]\n): [string, DomainResource | null] {\n  let status = '';\n  let resource: DomainResource | null = null;\n\n  switch (currentNode.type) {\n    case 'start':\n      status = 'completed'; // start node always complete\n      break;\n    case 'action': {\n      const data = patientData[currentNode.key];\n\n      let actionResource: DomainResource | null = null;\n      if (Array.isArray(data)) {\n        if (data.length > 0) {\n          actionResource = data[0];\n        }\n      } else if (data) {\n        actionResource = data;\n      }\n\n      if (actionResource) {\n        resource = actionResource;\n        status = 'status' in resource ? resource['status'] : 'unknown'; // TODO\n      } else {\n        resource = retrieveNote(currentNode.label, resources);\n      }\n\n      // finally check for \"advance\" notes\n      if (status !== 'completed' && shouldAdvance(currentNode, resources)) {\n        status = 'completed';\n      }\n\n      break;\n    }\n\n    case 'branch': {\n      // first see if any of the transition conditions evaluated to true\n      const hasAnyTrue = currentNode.transitions.some(\n        t => t?.condition?.description && patientData[t?.condition?.description]\n      );\n\n      if (hasAnyTrue) {\n        status = 'completed';\n      } else {\n        // if none are true, look for a DocRef to see if a specific path was chosen\n        // (note that we don't care which one it is here, but store the doc anyway,\n        //  so that we can use it later without looking it up all over again)\n        const branchNote = currentNode.transitions\n          .map(t => t?.condition && retrieveNote(t.condition.description, resources))\n          .find(n => n);\n        if (branchNote) {\n          status = 'completed';\n          resource = branchNote;\n        }\n      }\n      break;\n    }\n\n    default:\n      // 'null' or 'reference'\n      // TODO: how do we want to handle references?\n      // we should never hit a null in practice here\n      status = 'not-started';\n  }\n\n  return [status, resource];\n}\n\nfunction getNextNodes(\n  currentNode: PathwayNode,\n  patientData: PatientData,\n  resources: DomainResource[],\n  resource: DomainResource | null\n): string[] {\n  // IMPORTANT -- this function assumes that the current node is complete\n\n  let nextNodes: string[] = [];\n  // type: 'action' | 'branch' | 'reference' | 'start' | 'null';\n  switch (currentNode.type) {\n    case 'start':\n    case 'action':\n      // conditionals not allowed here\n      nextNodes = currentNode.transitions.map(t => t.transition);\n      break;\n\n    case 'branch': {\n      let noteChoice: string | undefined = undefined;\n\n      if (resource?.resourceType === 'DocumentReference') {\n        const note = resource as DocumentReference;\n        if (note?.identifier && note.identifier[0]?.value) {\n          noteChoice = atob(note.identifier[0].value);\n        }\n      }\n\n      nextNodes = currentNode.transitions\n        .filter(t => {\n          // either it matches by CQL, or it's the one the user previously chose\n          // (note that we don't currently allow for overriding CQL matches)\n          return (\n            t?.condition?.description &&\n            (patientData[t.condition.description] || t.condition.description === noteChoice)\n          );\n        })\n        .map(t => t.transition);\n\n      break;\n    }\n    default:\n      // 'null' or 'reference'\n      // TODO: how do we want to handle references?\n      // we should never hit a null in practice here\n      nextNodes = [];\n      break;\n  }\n  return nextNodes;\n}\n\n/**\n * Engine function to take in the ELM patient results and output data relating to the pathway preconditions\n * @param pathway - the entire pathway\n * @param patientData - the data on the patient from a CQL execution. Note this is a single patient not the entire patientResults object\n * @return returns PreconditionResult containing the expected and actual value for one data element\n */\nexport function preconditionData(pathway: Pathway, patientData: PatientData): PreconditionResult {\n  const resultItems: PreconditionResultItem[] = [];\n\n  let matches = 0;\n  pathway.preconditions.forEach(precondition => {\n    let evaluationResult = patientData[precondition.elementName];\n    if (Array.isArray(evaluationResult)) {\n      evaluationResult = evaluationResult[0]; // TODO: add functionality for multiple resources\n    }\n    let actual = 'unknown';\n    let match = false;\n\n    if (evaluationResult) {\n      actual = evaluationResult['value'];\n      match = evaluationResult['match'];\n    }\n\n    if (match) matches += 1;\n\n    const preconditionResultItem = {\n      elementName: precondition.elementName,\n      expected: precondition.expected,\n      actual,\n      match\n    };\n\n    resultItems.push(preconditionResultItem);\n  });\n\n  return {\n    pathwayName: pathway.name,\n    matches: matches,\n    preconditionResultItems: resultItems\n  };\n}\n\n/**\n * Helper function to obtain documentation for any nodes not on the path\n * @param pathway - the entire pathway\n * @param patientData - the data on the patient\n * @param resources - the patient resources\n * @param patientDocumentation - the documentation dictionary from nodes on the patient path\n */\nfunction getNonPathDocumentation(\n  pathway: Pathway,\n  patientData: PatientData,\n  resources: DomainResource[],\n  patientDocumentation: { [key: string]: Documentation }\n): void {\n  const nodesWithDocumentation = Object.values(patientDocumentation)\n    .filter(doc => doc.onPath)\n    .map(doc => doc.node);\n  for (const [nodeKey, node] of Object.entries(pathway.nodes)) {\n    if (!nodesWithDocumentation.includes(nodeKey)) {\n      if ('action' in node) {\n        // If action check for resource\n        if (patientData[nodeKey] && patientData[nodeKey].length) {\n          const documentation = patientData[nodeKey][0];\n          documentation.node = nodeKey;\n          documentation.onPath = false;\n          (documentation as DocumentationResource).resource = retrieveResource(\n            documentation,\n            resources\n          );\n          patientDocumentation[nodeKey] = { ...documentation };\n        }\n      } else {\n        // Tranisition element must check each transition in patient data for existence\n        for (const transition of (node as PathwayNode).transitions) {\n          if (!transition.condition) continue;\n\n          // note, branch nodes no longer have documentation resources, just boolean\n\n          // Check for document reference note\n          const documentReference = retrieveNote(transition.condition.description, resources);\n          if (documentReference) {\n            const documentation = {\n              resourceType: 'DocumentReference',\n              status: documentReference.status,\n              id: documentReference.id,\n              node: nodeKey,\n              onPath: false,\n              resource: documentReference\n            };\n            patientDocumentation[nodeKey] = { ...documentation };\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Helper function to determine whether current node should be skipped and pathway execution should advance\n * Checks for DocumentReference resource with node label and advance\n * @param currentNode current node\n * @param resources list of patient resources\n * @return boolean as to whether pathway execution should advance\n */\nfunction shouldAdvance(currentNode: PathwayNode, resources: DomainResource[]): boolean {\n  return resources.some(r => {\n    if (r.resourceType !== 'DocumentReference') return false;\n    const content = (r as DocumentReference).content[0].attachment.data;\n    if (content) {\n      const convertedContent = atob(content);\n      return convertedContent === `${currentNode.label} - Advance`;\n    }\n\n    return false;\n  });\n}\n\n/**\n * Helper function to retrieve a resource for documentation if one exists.\n * @param doc - the docuumentation to find a resource for\n * @param resources - the list of patient resources\n * @return DomainResource for the documentation or undefined if none found\n */\nfunction retrieveResource(\n  doc: Documentation,\n  resources: DomainResource[]\n): DomainResource | undefined {\n  let resource: DomainResource | undefined = undefined;\n  if ('resourceType' in doc && resources) {\n    resource = resources.find(resource => {\n      return (\n        resource.resourceType === (doc as DocumentationResource).resourceType &&\n        resource.id === (doc as DocumentationResource).id\n      );\n    });\n  }\n\n  return resource;\n}\n","import { extractCQL, CqlObject } from './cql-extractor';\nimport convertCQL, { convertBasicCQL, ElmObject } from './cql-to-elm';\nimport executeElm from './elm-executor';\nimport { pathwayData, preconditionData } from './output-results';\nimport {\n  Pathway,\n  PatientData,\n  PathwayResults,\n  ElmResults,\n  PreconditionResult\n} from 'pathways-model';\nimport { DomainResource, Bundle } from 'fhir-objects';\nfunction instanceOfElmObject(object: object): object is ElmObject {\n  return 'main' in object;\n}\n\n/**\n * Function to run each of the engine files in series to execute\n * the automated pathway\n * @param patientRecord - Patient's record as FHIR data\n * @param pathway - entire Pathway object\n * @return Information on the patient's current status within the\n *                  clinical pathway\n */\nexport function evaluatePatientOnPathway(\n  patientRecord: Bundle,\n  pathway: Pathway,\n  resources: DomainResource[]\n): Promise<PathwayResults> {\n  const patientDataPromise = pathway.elm?.navigational\n    ? processELMCommon(patientRecord, pathway.elm.navigational)\n    : extractCQL(pathway).then(cql => processCQLCommon(patientRecord, cql));\n\n  return patientDataPromise.then(patientData => pathwayData(pathway, patientData, resources));\n}\n\n/**\n * Evaluate the pathway preconditions against the given patient.\n * @param patientRecord - Patient's record as FHIR data\n * @param pathway - entire Pathway object\n * @return a list of PreconditionResults, each containing\n *         the expected value and actual value for one precondition item\n */\nexport function evaluatePathwayPreconditions(\n  patientRecord: Bundle,\n  pathway: Pathway\n): Promise<PreconditionResult> {\n  const patientDataPromise = pathway.elm?.preconditions\n    ? processELMCommon(patientRecord, pathway.elm.preconditions)\n    : extractCQL(pathway).then(cql => processCQLCommon(patientRecord, cql));\n\n  return patientDataPromise.then(patientData => preconditionData(pathway, patientData));\n}\n\n/**\n * Common logic to execute the given CQL against the given Patient.\n * @param patientRecord - Patient's record as FHIR data\n * @param cql - aggregated CQL from a pathway\n * @return the raw, unprocessed patientResults\n *         derived from executing the CQL against the given patient\n */\nfunction processCQLCommon(patientRecord: Bundle, cql: CqlObject): Promise<PatientData> {\n  const elmPromise =\n    Object.keys(cql.libraries).length > 0 ? convertCQL(cql) : convertBasicCQL(cql.main);\n\n  return elmPromise.then(elm => processELMCommon(patientRecord, elm));\n}\n\n/**\n * Common logic to execute the given ELM against the given Patient.\n * @param patientRecord - Patient's record as FHIR data\n * @param elm - resulting ELM from converting the CQL in a pathway\n * @return the raw, unprocessed patientResults\n *         derived from executing the ELM against the given patient\n */\nfunction processELMCommon(patientRecord: Bundle, elm: object): Promise<PatientData> {\n  // this is not inherently async,\n  // but we wrap it in a promise to make the code cleaner elsewhere\n  return new Promise((resolve, reject) => {\n    let elmResults: ElmResults;\n    if (instanceOfElmObject(elm)) {\n      elmResults = executeElm(patientRecord, elm.main, elm.libraries);\n    } else {\n      elmResults = executeElm(patientRecord, elm);\n    }\n\n    // TODO - update pathwaysData to take multiple patients\n    const patientIds = Object.keys(elmResults.patientResults);\n    const patientData = elmResults.patientResults[patientIds[0]];\n    resolve(patientData);\n  });\n}\n","import React, { FC, useState, useEffect, useRef, RefObject } from 'react';\nimport { usePatient } from 'components/PatientProvider';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport {\n  AllergiesVisualizer,\n  CarePlansVisualizer,\n  ConditionsVisualizer,\n  EncountersVisualizer,\n  ImmunizationsVisualizer,\n  MedicationsVisualizer,\n  ObservationsVisualizer,\n  PatientVisualizer,\n  ProceduresVisualizer,\n  ReportsVisualizer\n} from 'fhir-visualizers';\nimport { DomainResource } from 'fhir-objects';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faNotesMedical,\n  faChevronLeft,\n  faChevronUp,\n  faChevronDown\n} from '@fortawesome/free-solid-svg-icons';\nimport styles from './PatientRecord.module.scss';\nimport { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport { PreconditionResult } from 'pathways-model';\nimport { usePathwayContext } from 'components/PathwayProvider';\nimport { evaluatePathwayPreconditions } from 'engine';\nimport { McodeElements } from 'mcode';\n\nconst recordSections = [\n  'Pathway',\n  'Mcode',\n  'Patient',\n  'Condition',\n  'Observation',\n  'DiagnosticReport',\n  'MedicationRequest',\n  'AllergyIntolerance',\n  'CarePlan',\n  'Procedure',\n  'Encounter',\n  'Immunization'\n];\n\nconst groupResourceByType = (\n  patientRecord: ReadonlyArray<DomainResource>\n): ReadonlyMap<string, ReadonlyArray<DomainResource>> => {\n  const map: Map<string, DomainResource[]> = new Map();\n  patientRecord.forEach(resource => {\n    const resourceType = resource.resourceType ?? '';\n    if (recordSections.includes(resourceType)) {\n      const collection = map.get(resourceType);\n      if (!collection) map.set(resourceType, [resource]);\n      else collection.push(resource);\n    }\n  });\n  return map;\n};\n\nconst getResourcesByType = (\n  resourceType: string,\n  groupedResources: ReadonlyMap<string, ReadonlyArray<DomainResource>>\n): ReadonlyArray<DomainResource> => {\n  return groupedResources.get(resourceType) ?? [];\n};\n\ninterface PatientRecordProps {\n  headerElement: RefObject<HTMLDivElement>;\n}\n\ninterface PatientRecordElementProps {\n  recordSection: string;\n  resources: ReadonlyArray<DomainResource>;\n}\n\ninterface VisualizerProps {\n  recordSection: string;\n  resourcesByType: ReadonlyArray<DomainResource>;\n}\n\nconst PatientRecord: FC<PatientRecordProps> = ({ headerElement }) => {\n  const { patientRecords } = usePatientRecords();\n  const recordContainerElement = useRef<HTMLDivElement>(null);\n  const [isExpanded, setIsExpanded] = useState<boolean>(false);\n  const groupedResources = groupResourceByType(patientRecords);\n\n  const expand = (): void => {\n    setIsExpanded(!isExpanded);\n  };\n\n  // Set the height of the patient record container\n  useEffect(() => {\n    if (recordContainerElement?.current && headerElement?.current)\n      recordContainerElement.current.style.height =\n        window.innerHeight - headerElement.current.clientHeight + 'px';\n  }, [isExpanded, headerElement]);\n\n  if (isExpanded) {\n    return (\n      <div className={styles.record} ref={recordContainerElement}>\n        <div className={styles.sidebar}>\n          {recordSections.map(recordSection => (\n            <PatientRecordElement\n              recordSection={recordSection}\n              resources={getResourcesByType(recordSection, groupedResources)}\n              key={recordSection}\n            />\n          ))}\n        </div>\n\n        <div className={styles.recordToggle} onClick={expand}>\n          <FontAwesomeIcon icon={faChevronLeft} />\n        </div>\n      </div>\n    );\n  } else {\n    return (\n      <div className={styles.record}>\n        <div className={styles.recordToggle} onClick={expand}>\n          <FontAwesomeIcon icon={faNotesMedical} />\n        </div>\n      </div>\n    );\n  }\n};\n\nconst PatientRecordElement: FC<PatientRecordElementProps> = ({ recordSection, resources }) => {\n  const [isExpanded, setIsExpanded] = useState<boolean>(false);\n\n  const chevron: IconProp = isExpanded ? faChevronUp : faChevronDown;\n  const resourceCount: string = !['Patient', 'Pathway', 'Mcode'].includes(recordSection)\n    ? `(${resources.length})`\n    : '';\n\n  return (\n    <div className={styles.element}>\n      <div className={styles.title} onClick={(): void => setIsExpanded(!isExpanded)}>\n        <div>\n          {recordSection} {resourceCount}\n        </div>\n        <div className={styles.expand}>\n          <FontAwesomeIcon icon={chevron} />\n        </div>\n      </div>\n\n      {isExpanded && (\n        <div className={styles.visualizerContainer}>\n          <Visualizer recordSection={recordSection} resourcesByType={resources} />\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst Visualizer: FC<VisualizerProps> = ({ recordSection, resourcesByType }) => {\n  const patient = usePatient().patient as fhir.Patient;\n\n  if (recordSection === 'Pathway') return <PathwayVisualizer />;\n  else if (recordSection === 'Mcode') return <McodeVisualizer />;\n  else if (recordSection === 'Patient') return <PatientVisualizer patient={patient} />;\n  else if (recordSection === 'Condition') return <ConditionsVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'Observation')\n    return <ObservationsVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'DiagnosticReport')\n    return <ReportsVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'MedicationRequest')\n    return <MedicationsVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'AllergyIntolerance')\n    return <AllergiesVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'CarePlan') return <CarePlansVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'Procedure') return <ProceduresVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'Encounter') return <EncountersVisualizer rows={resourcesByType} />;\n  else if (recordSection === 'Immunization')\n    return <ImmunizationsVisualizer rows={resourcesByType} />;\n  else return <div>Unsupported Resource</div>;\n};\n\nconst PathwayVisualizer: FC = () => {\n  const { patientRecords } = usePatientRecords();\n  const { evaluatedPathway } = usePathwayContext();\n  const [preconditions, setPreconditions] = useState<PreconditionResult | null>(null);\n\n  useEffect(() => {\n    // Create a Bundle for the CQL engine and check if patientPath needs to be evaluated\n    const patient = {\n      resourceType: 'Bundle',\n      type: 'searchset',\n      entry: patientRecords.map((r: fhir.Resource) => ({ resource: r }))\n    };\n\n    // Evaluate pathway preconditions\n    if (evaluatedPathway) {\n      evaluatePathwayPreconditions(patient, evaluatedPathway.pathway).then(preconditionResult =>\n        setPreconditions(preconditionResult)\n      );\n    }\n  }, [evaluatedPathway, patientRecords]);\n\n  return (\n    <table>\n      <tbody>\n        {preconditions?.preconditionResultItems.map(c => (\n          <tr key={c.elementName}>\n            <td>{c.elementName}</td>\n            <td>{c.actual}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n};\n\nconst McodeVisualizer: FC = () => {\n  const { mcodeRecords } = usePatientRecords();\n  type mcodeKey = keyof McodeElements & string;\n  const keysArray: mcodeKey[] = [];\n  for (const key in mcodeRecords) {\n    keysArray.push(key as mcodeKey);\n  }\n  return (\n    <table>\n      <tbody>\n        {keysArray.map(key => {\n          return (\n            <tr key={key}>\n              <td>{key}</td>\n              <td>{mcodeRecords[key] ? mcodeRecords[key] : '-'}</td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n\nexport default PatientRecord;\n","/* eslint-disable guard-for-in */\n/* eslint-disable max-len */\n\nimport { Pathway, PathwayNode } from 'pathways-model';\nimport { Node, Nodes, Layout, NodeCoordinates, Edges, NodeDimensions } from 'graph-model';\n\nimport dagre from 'dagre';\n\nimport config from 'utils/ConfigManager';\nconst graphLayoutProvider = config.get('graphLayoutProvider', 'dagre');\n\n/**\n * Obtain the graph layout for the pathway as coordinates for every node\n *\n * @param pathway - JSON pathway\n */\nexport default function layout(pathway: Pathway, nodeDimensions: NodeDimensions): Layout {\n  return graphLayoutProvider === 'dagre'\n    ? layoutDagre(pathway, nodeDimensions)\n    : layoutCustom(pathway);\n}\n\n/**\n * Layout the pathway using the Dagre layout engine.\n * @see {@link https://github.com/dagrejs/dagre}\n */\nfunction layoutDagre(pathway: Pathway, nodeDimensions: NodeDimensions): Layout {\n  const START = 'Start';\n  const NODE_HEIGHT = 50;\n  const NODE_WIDTH_FACTOR = 10; // factor to convert label length => width, assume font size roughly 10\n  const nodeKeys = Object.keys(pathway.nodes);\n  const g = new dagre.graphlib.Graph();\n\n  g.setGraph({});\n  g.setDefaultEdgeLabel(() => ({})); // dagre requires a default edge label, we want it to just be empty\n\n  nodeKeys.forEach(nodeKey => {\n    const node: PathwayNode = pathway.nodes[nodeKey];\n    const nodeDimension = nodeDimensions[nodeKey];\n\n    if (nodeDimension) {\n      g.setNode(nodeKey, {\n        label: node.label,\n        width: nodeDimension.width,\n        height: nodeDimension.height\n      });\n    } else {\n      g.setNode(nodeKey, {\n        label: node.label,\n        width: node.label.length * NODE_WIDTH_FACTOR,\n        height: NODE_HEIGHT\n      });\n    }\n\n    node.transitions.forEach(transition => {\n      const label = transition.condition\n        ? {\n            label: transition.condition.description,\n            width: 25,\n            height: 20\n          }\n        : {};\n\n      g.setEdge(nodeKey, transition.transition, label);\n    });\n  });\n\n  dagre.layout(g);\n  const nodeCoordinates: NodeCoordinates = {};\n  const startNodeShift = g.node(START).x;\n\n  for (const nodeKey of nodeKeys) {\n    const node = g.node(nodeKey);\n    // dagre returns coordinates for the center of the node,\n    // our renderer expects coordinates for the corner of the node.\n    // further, our renderer expects the Start node to be centered at x: 0\n    nodeCoordinates[nodeKey] = {\n      x: node.x - startNodeShift - node.width / 2,\n      y: node.y - node.height / 2\n    };\n  }\n\n  const edges: Edges = {};\n\n  g.edges().forEach(e => {\n    const edge = g.edge(e);\n    const edgeName = `${e.v}, ${e.w}`;\n    const label = edge.label ? { text: edge.label, x: edge.x - startNodeShift, y: edge.y } : null;\n\n    edges[edgeName] = {\n      label,\n      start: e.v,\n      end: e.w,\n      points: edge.points.map(p => {\n        return {\n          x: p.x - startNodeShift,\n          y: p.y\n        };\n      })\n    };\n  });\n\n  return { nodeCoordinates, edges };\n}\n\n/**\n * Layout the pathway using our homegrown layout algorithm.\n */\nfunction layoutCustom(pathway: Pathway): Layout {\n  const START = 'Start';\n  const NODE_WIDTH = 100;\n  const NODE_HEIGHT = 50;\n  const MIN_MARGIN_X = 10;\n  const MIN_MARGIN_Y = 50;\n  const nodes: Nodes = initializeNodes(pathway);\n  const graph: string[][] = [[START]];\n  const HORIZONTAL_OFFSET = NODE_WIDTH + MIN_MARGIN_X;\n  const VERTICAL_OFFSET = NODE_HEIGHT + MIN_MARGIN_Y;\n\n  // Set the rank for every node\n  let rank = 0;\n  do {\n    // Iterate over each node on the current level\n    for (const nodeKey of graph[rank]) {\n      // Assign all children to the next rank\n      assignRankToChildren(nodes[nodeKey], rank + 1);\n    }\n\n    rank++;\n\n    // To start rank = 0 and graph.length = 1. In each iteration children will be added\n    // to the next rank incrementing the length of graph. When there are no new children\n    // the graph.length will remain unchanged but the rank would have increased by one.\n    // Therefore we stop when the rank and graph length are the same.\n  } while (graph.length !== rank);\n\n  // Set the position of nodes within the rank\n  assignHorizontalPositionToNode(nodes[START], -1 * (NODE_WIDTH / 2));\n  for (rank = 1; rank < graph.length; rank++) {\n    assignHorizontalPositionToNodesInRank(rank);\n  }\n\n  return {\n    nodeCoordinates: produceCoordinates(),\n    edges: {}\n  };\n\n  /**\n   * Convert the Nodes into a Coordinates object\n   *\n   * @returns Coordinates for every node\n   */\n  function produceCoordinates(): NodeCoordinates {\n    const coordinates: NodeCoordinates = {};\n\n    for (const nodeKey in nodes) {\n      const node = nodes[nodeKey];\n      coordinates[nodeKey] = {\n        x: node.horizontalPosition,\n        y: node.rank * VERTICAL_OFFSET\n      };\n    }\n\n    return coordinates;\n  }\n\n  /**\n   * Set the horizontal position for child elements of a parent\n   *\n   * @param parent - the parent Node\n   * @param nodes - the Nodes\n   */\n  function spreadChildrenEvenly(parent: Node): void {\n    const children = parent.children.filter(\n      c => isNaN(nodes[c].horizontalPosition) || nodes[c].canMove\n    );\n    if (children.length === 0) return;\n    if (children.length === 1) {\n      assignHorizontalPositionToNode(nodes[children[0]], parent.horizontalPosition);\n      return;\n    }\n    if (children.length % 2 === 1) children.splice(Math.ceil(children.length / 2), 1); // Remove middle element if odd\n\n    // TODO: this does not consider if there are connections between the children which order to put them in\n    for (let i = 0; i < children.length / 2; i++) {\n      // Set the left child i from the center\n      let childNode = nodes[children[children.length / 2 - i - 1]];\n      assignHorizontalPositionToNode(\n        childNode,\n        parent.horizontalPosition - (i + 1) * HORIZONTAL_OFFSET\n      );\n      childNode.canMove = false;\n\n      // Set the right child i from the center\n      childNode = nodes[children[children.length / 2 + i]];\n      assignHorizontalPositionToNode(\n        childNode,\n        parent.horizontalPosition + (i + 1) * HORIZONTAL_OFFSET\n      );\n      childNode.canMove = false;\n    }\n  }\n\n  /**\n   * Assigns the node given by nodeKey the horizontal position hPos if it is not already set\n   * @param node - the node to set the horizontal position of\n   * @param hPos - the horizontal position for the node\n   */\n  function assignHorizontalPositionToNode(node: Node, hPos: number): void {\n    if (isNaN(node.horizontalPosition) || node.canMove) {\n      node.horizontalPosition = hPos;\n\n      // Check the new position is not on top of another node\n      let i = 1;\n      while (hasOverlap(node)) {\n        // Update Horizontal position of this node\n        // Alternate directions moving further and further away\n        const direction = i % 2 === 0 ? -1 : 1;\n        node.horizontalPosition = hPos + direction * Math.ceil(i / 2) * HORIZONTAL_OFFSET;\n        i += 1;\n      }\n    }\n  }\n\n  /**\n   * Assigns the horizontal position of all nodes on the current level\n   *\n   * @param rank - the level of the graph to assign node positions of\n   */\n  function assignHorizontalPositionToNodesInRank(rank: number): void {\n    for (const nodeKey of graph[rank]) {\n      const node = nodes[nodeKey];\n      if (!isNaN(node.horizontalPosition)) continue;\n      const parentsOnHigherRank = node.parents.filter(p => nodes[p].rank < node.rank);\n      if (parentsOnHigherRank.length === 1) {\n        const parentName = node.parents[0];\n        const parent = nodes[parentName];\n\n        if (parent.children.length % 2 === 1) {\n          // Odd number of children: one directly below, others to the side\n          const childNode = nodes[parent.children[Math.floor(parent.children.length / 2)]];\n          assignHorizontalPositionToNode(childNode, parent.horizontalPosition);\n        }\n        spreadChildrenEvenly(parent);\n      } else {\n        // Multiple Parents: Place the node at the average of parents on higher rank\n        // TODO: collect all parents to be next to each other\n        const sum = parentsOnHigherRank\n          .map(p => nodes[p].horizontalPosition)\n          .reduce((a, b) => a + b, 0);\n\n        assignHorizontalPositionToNode(node, sum / parentsOnHigherRank.length);\n      }\n    }\n  }\n\n  /**\n   * Determines if the node overlaps with any other nodes in the rank\n   *\n   * @param node - the node to check for overlap with\n   * @returns true if the node overlaps with any other node in the rank, false otherwise\n   */\n  function hasOverlap(node: Node): boolean {\n    const nodesInRank = graph[node.rank].map(name => nodes[name]);\n\n    for (const otherNode of nodesInRank) {\n      if (nodesOverlap(node, otherNode)) return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Helper function to determine if two nodes are in the same slot\n   *\n   * @param node - the first node\n   * @param otherNode - the second node\n   * @returns true if the nodes share same rank and position, false otherwise\n   */\n  function nodesOverlap(node: Node, otherNode: Node): boolean {\n    if (nodesEqual(node, otherNode)) return false;\n    else\n      return (\n        !isNaN(node.rank) &&\n        !isNaN(node.horizontalPosition) &&\n        !isNaN(otherNode.rank) &&\n        !isNaN(otherNode.horizontalPosition) &&\n        node.rank === otherNode.rank &&\n        node.horizontalPosition === otherNode.horizontalPosition\n      );\n  }\n\n  /**\n   * Determine if two nodes are the same\n   *\n   * @param node - the first node\n   * @param otherNode - the second node\n   * @returns true if the two nodes are the same (have the same label)\n   */\n  function nodesEqual(node: Node, otherNode: Node): boolean {\n    return node.label === otherNode.label;\n  }\n\n  /**\n   * Assigns the rank to every child of node. If the child has a lower rank the entire\n   * subtree rooted at that child will be shifted down by recursively assigning rank to\n   * the children.\n   *\n   * @param nodes - the Nodes\n   * @param graph - the graph as list of nodes by level\n   * @param node - the node to get children from\n   * @param rank - the rank to assign to the children\n   */\n  function assignRankToChildren(node: Node, rank: number): void {\n    node.children.forEach(child => {\n      const childNode = nodes[child];\n\n      // If the child is on a higher rank than the parent (node) move subtree rooted at child down\n      if (childNode.rank < node.rank) {\n        // Remove node from previous rank\n        graph[childNode.rank].splice(graph[childNode.rank].indexOf(child), 1);\n\n        // Move this node down\n        assignRankToNode(child, rank);\n\n        // Move all children of this child down\n        assignRankToChildren(childNode, rank + 1);\n      } else if (isNaN(childNode.rank)) assignRankToNode(child, rank);\n    });\n  }\n\n  /**\n   * Assigns the node labeled by nodeKey the rank by updating graph and nodes data structures\n   *\n   * @param nodes - the Nodes\n   * @param graph - the graph as list of nodes by level\n   * @param nodeKey - the name of the node to set the rank of\n   * @param rank - the new rank for the node\n   */\n  function assignRankToNode(nodeKey: string, rank: number): void {\n    try {\n      graph[rank].push(nodeKey);\n    } catch (err) {\n      graph[rank] = [nodeKey];\n    } finally {\n      nodes[nodeKey].rank = rank;\n    }\n  }\n\n  /**\n   * Initialize the Nodes data structure for the graph representation\n   *\n   * @param pathway - JSON Pathway\n   * @returns initial Nodes data structure with default values\n   */\n  function initializeNodes(pathway: Pathway): Nodes {\n    const nodes: Nodes = {};\n\n    // Iniitalize each node with default values\n    let nodeKey: string;\n    for (nodeKey in pathway.nodes) {\n      nodes[nodeKey] = {\n        label: nodeKey,\n        rank: NaN,\n        horizontalPosition: NaN,\n        children: [],\n        parents: [],\n        canMove: true\n      };\n    }\n\n    // Set the child and parent properties of each node\n    Object.keys(pathway.nodes).forEach(nodeKey => {\n      const node: PathwayNode = pathway.nodes[nodeKey];\n\n      node.transitions.forEach(transition => {\n        if (!nodes[nodeKey].children.includes(transition.transition))\n          nodes[nodeKey].children.push(transition.transition);\n        if (!nodes[transition.transition].parents.includes(nodeKey))\n          nodes[transition.transition].parents.push(nodeKey);\n      });\n    });\n\n    nodes[START].rank = 0;\n\n    return nodes;\n  }\n}\n","import React, { FC, ReactElement } from 'react';\nimport { Popup, StrictPopupProps } from 'semantic-ui-react';\nimport styles from './PathwayPopup.module.scss';\n\ninterface PathwayPopupProps {\n  Content: ReactElement;\n  Trigger: ReactElement;\n  popupPosition?: StrictPopupProps['position'];\n  open?: boolean;\n  setOpen?: Function;\n  className?: string;\n}\n\nconst PathwayPopup: FC<PathwayPopupProps> = ({\n  Content,\n  Trigger,\n  popupPosition,\n  open,\n  setOpen,\n  className\n}: PathwayPopupProps) => {\n  return (\n    <Popup\n      content={Content}\n      position={popupPosition || 'bottom right'}\n      className={`${styles.pathwayPopup} ${className}`}\n      on=\"click\"\n      open={open}\n      onOpen={(): void => {\n        setOpen && setOpen(true);\n      }}\n      onClose={(): void => {\n        setOpen && setOpen(false);\n      }}\n      pinned\n      trigger={Trigger}\n    />\n  );\n};\n\nexport default PathwayPopup;\n","import React, { FC } from 'react';\nimport styles from './ActionButton.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faCheck } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\ninterface ButtonProps {\n  type: 'accept' | 'decline';\n  onClick?: () => void;\n}\n\ninterface ActionButtonProps extends ButtonProps {\n  size: 'small' | 'large' | 'medium';\n}\n\nconst LargeActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  return (\n    <Button\n      onClick={onClick}\n      variant={type === 'decline' ? 'text' : 'contained'}\n      color={type === 'decline' ? 'secondary' : 'primary'}\n    >\n      {type[0].toUpperCase() + type.slice(1)}\n    </Button>\n  );\n};\n\nconst SmallActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  return (\n    <div\n      className={`${type === 'accept' ? styles.accept : styles.decline} ${\n        styles.smallActionButton\n      }`}\n      onClick={onClick}\n      data-testid={type}\n    >\n      <FontAwesomeIcon icon={type === 'accept' ? faCheck : faTimes} />\n    </div>\n  );\n};\n\nconst MediumActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  const buttonText = {\n    accept: 'Submit',\n    decline: 'Cancel'\n  };\n  return (\n    <div\n      className={`${type === 'accept' ? styles.accept : styles.decline} ${\n        styles.mediumActionButton\n      }`}\n      onClick={onClick}\n      data-testid={type}\n    >\n      <FontAwesomeIcon icon={type === 'accept' ? faCheck : faTimes} />\n      {buttonText[type]}\n    </div>\n  );\n};\n\nconst ActionButton: FC<ActionButtonProps> = ({ type, size, onClick }) => {\n  switch (size) {\n    case 'small':\n      return <SmallActionButton type={type} onClick={onClick} />;\n    case 'large':\n      return <LargeActionButton type={type} onClick={onClick} />;\n    case 'medium':\n      return <MediumActionButton type={type} onClick={onClick} />;\n  }\n};\n\nexport default ActionButton;\n","import React, { FC, useState } from 'react';\nimport styles from './MissingDataPopup.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport PathwayPopup from 'components/PathwayPopup';\nimport ActionButton from 'components/ActionButton';\nimport { faEdit } from '@fortawesome/free-solid-svg-icons';\nimport { usePatient } from 'components/PatientProvider';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport { useFHIRClient } from 'components/FHIRClient';\nimport { createActionDocumentReference, createNoteContent } from 'utils/fhirUtils';\nimport { useNote } from 'components/NoteDataProvider';\ninterface MissingDataPopup {\n  values: string[];\n}\n\nconst MissingDataPopup: FC<MissingDataPopup> = ({ values }) => {\n  const [open, setOpen] = useState<boolean>(false);\n  return (\n    <PathwayPopup\n      Content={<PopupContent values={values} setOpen={setOpen}></PopupContent>}\n      className={styles.missingDataPopup}\n      Trigger={\n        <div className={styles.popupTrigger}>\n          missing data\n          <FontAwesomeIcon icon={faEdit} className={styles.externalLink} />\n        </div>\n      }\n      open={open}\n      setOpen={setOpen}\n    />\n  );\n};\n\ninterface PopupContentProps {\n  values: Array<string>;\n  setOpen: Function;\n}\n\nconst PopupContent: FC<PopupContentProps> = ({ values, setOpen }) => {\n  const patient = usePatient().patient as fhir.Patient;\n  const client = useFHIRClient();\n  const { patientRecords, setPatientRecords } = usePatientRecords();\n  const [showCheck, setShowCheck] = useState<boolean>(false);\n  const [selected, setSelected] = useState<string>('');\n  const { note } = useNote();\n\n  return (\n    <div>\n      <div className={styles.popupContent}>\n        Select Value:\n        <div>\n          {values.map(e => {\n            return (\n              <div\n                key={e}\n                className={styles.popupChoice + ' ' + (selected === e ? styles.selected : '')}\n                onClick={(): void => {\n                  if (showCheck && selected === e) {\n                    setShowCheck(false);\n                    setSelected('');\n                  } else {\n                    setShowCheck(true);\n                    setSelected(e);\n                  }\n                }}\n              >\n                {e}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n      <div className={styles.footer}>\n        <ActionButton size=\"small\" type=\"decline\" onClick={(): void => setOpen(false)} />\n        {showCheck && (\n          <ActionButton\n            size=\"small\"\n            type=\"accept\"\n            onClick={(): void => {\n              setOpen(false);\n              // Create DocumentReference with selected value and add to patient record\n              if (note) {\n                const noteString = createNoteContent(note, patientRecords, 'completed', selected);\n                const documentReference = createActionDocumentReference(\n                  noteString,\n                  selected,\n                  patient\n                );\n                setPatientRecords([...patientRecords, documentReference]);\n                client?.create?.(documentReference);\n              }\n            }}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default MissingDataPopup;\n","import React, { FC, ReactNode } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { IconDefinition } from '@fortawesome/fontawesome-common-types';\nimport styles from './ReportSection.module.scss';\nimport shortid from 'shortid';\n\ninterface ReportSectionProps {\n  icon: IconDefinition;\n  fields: { name: ReactNode; value: ReactNode }[];\n}\n\nconst ReportSection: FC<ReportSectionProps> = ({ icon, fields }) => {\n  return (\n    <div className={styles.sectionContainer}>\n      <div className={styles.sectionIconContainer}>\n        <FontAwesomeIcon icon={icon} className={styles.icon} />\n      </div>\n      <div className={styles.fieldContainer}>\n        {fields\n          .filter(field => field.name)\n          .map(field => (\n            <ReportField sectionTitle={field.name} value={field.value} key={shortid.generate()} />\n          ))}\n      </div>\n    </div>\n  );\n};\n\ninterface ReportFieldProps {\n  sectionTitle: ReactNode;\n  value: ReactNode;\n}\n\nconst ReportField: FC<ReportFieldProps> = ({ sectionTitle, value }) => {\n  return (\n    <div className={styles.field}>\n      <b>{sectionTitle}: </b>\n      <span>{value}</span>\n    </div>\n  );\n};\n\ninterface PhysicianNotesProps {\n  icon: IconDefinition;\n  notes: string;\n}\n\nconst PhysicianNotesSection: FC<PhysicianNotesProps> = ({ icon, notes }) => {\n  return (\n    <div className={styles.sectionContainer}>\n      <div className={styles.sectionIconContainer}>\n        <FontAwesomeIcon icon={icon} className={styles.icon} />\n      </div>\n      <div className={styles.notesField}>\n        <b>Physician Notes: </b>\n        <div>{notes}</div>\n      </div>\n    </div>\n  );\n};\n\nexport { PhysicianNotesSection };\nexport default ReportSection;\n","import React, { FC } from 'react';\nimport { useNote } from 'components/NoteDataProvider';\nimport ReportSection, { PhysicianNotesSection } from './ReportSection';\nimport styles from './ReportModal.module.scss';\nimport { faUser, faNotesMedical, faRoute, faStickyNote } from '@fortawesome/free-solid-svg-icons';\nimport ActionButton from 'components/ActionButton';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport { getTNM } from 'utils/fhirUtils';\n\ninterface ReportModalInterface {\n  onConfirm: () => void;\n  onDecline: () => void;\n}\n\nconst ReportModal: FC<ReportModalInterface> = ({ onConfirm, onDecline }) => {\n  const { note } = useNote();\n  const { mcodeRecords } = usePatientRecords();\n  const reportName = 'Pathway Report';\n  const patientSection = [\n    { name: 'Date', value: note?.date },\n    { name: 'Patient', value: note?.patient },\n    { name: 'Date of Birth', value: note?.birthdate },\n    { name: 'Physician', value: note?.physician }\n  ];\n\n  const observationField = [\n    { name: 'Primary Cancer', value: mcodeRecords['Primary Cancer'] ?? 'Unknown' },\n    { name: 'Laterality', value: mcodeRecords.Laterality ?? 'Unknown' },\n    { name: 'Clinical TNM', value: getTNM(mcodeRecords) },\n    { name: 'Estrogen Receptor', value: mcodeRecords['Estrogen Receptor'] ?? 'Unknown' },\n    { name: 'Progesterone Receptor', value: mcodeRecords['Progesterone Receptor'] ?? 'Unknown' },\n    { name: 'HER2 Receptor', value: mcodeRecords['HER2 Receptor'] ?? 'Unknown' }\n  ];\n\n  const pathwaySection = [\n    { name: 'Pathway Selected', value: note?.pathway },\n    { name: 'Recommendation', value: note?.node },\n    { name: 'Pathway Status', value: note?.status }\n  ];\n  return (\n    <div className={styles.reportModal}>\n      <h1>{reportName}</h1>\n      <div className={styles.sectionContainer}>\n        <ReportSection icon={faUser} fields={patientSection} />\n        <ReportSection icon={faNotesMedical} fields={observationField} />\n        <ReportSection icon={faRoute} fields={pathwaySection} />\n        {note?.notes && <PhysicianNotesSection icon={faStickyNote} notes={note?.notes} />}\n      </div>\n      <div className={styles.confirmationSection}>\n        <i>\n          The above note will be written into the EHR and any procedure requests will be submitted.\n        </i>\n        <div className={styles.confirmationButtonGroup}>\n          <ActionButton size=\"medium\" type=\"accept\" onClick={onConfirm} />\n          <ActionButton size=\"medium\" type=\"decline\" onClick={onDecline} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ReportModal;\n","import React, { FC, ReactNode, ReactElement, useState, memo } from 'react';\nimport { ActionNode, DocumentationResource, PathwayNode, Action } from 'pathways-model';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport MissingDataPopup from 'components/MissingDataPopup';\nimport styles from './ExpandedNode.module.scss';\nimport indexStyles from 'styles/index.module.scss';\nimport ActionButton from 'components/ActionButton';\nimport ReportModal from 'components/ReportModal';\nimport { isBranchNode } from 'utils/nodeUtils';\nimport { useFHIRClient } from 'components/FHIRClient';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport { usePatient } from 'components/PatientProvider';\nimport {\n  translatePathwayRecommendation,\n  createActionDocumentReference,\n  createDocumentReference,\n  createNoteContent\n} from 'utils/fhirUtils';\nimport { faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\nimport { useNote } from 'components/NoteDataProvider';\nimport {\n  Resource,\n  DocumentReference,\n  Observation,\n  Procedure,\n  Identifier,\n  MedicationRequest,\n  ServiceRequest,\n  CarePlan\n} from 'fhir-objects';\nimport { retrieveNote } from 'utils/fhirUtils';\n\ninterface ExpandedNodeProps {\n  actionNode: ActionNode;\n  isActionable: boolean;\n  isCurrentNode: boolean;\n  isAction: boolean;\n  documentation: DocumentationResource | undefined;\n  isAccepted: boolean | null;\n}\n\nconst ExpandedNode: FC<ExpandedNodeProps> = memo(\n  ({ actionNode, isActionable, isCurrentNode, isAction, documentation, isAccepted }) => {\n    const { note, setNote } = useNote();\n    const [showReport, setShowReport] = useState<boolean>(false);\n    const { patientRecords, setPatientRecords } = usePatientRecords();\n    const client = useFHIRClient();\n    const setComments = (nc: string): void => {\n      setNote(prevNote => {\n        return { ...prevNote, notes: nc };\n      });\n    };\n    const patient = usePatient().patient as fhir.Patient;\n    if (note) note.node = actionNode.label;\n\n    const onConfirm = (action?: Action): void => {\n      const newPatientRecords = [...patientRecords];\n\n      // Create DocumentReference and add to patient record(and post to FHIR server)\n      if (note) {\n        const noteString = createNoteContent(\n          note,\n          patientRecords,\n          note.status,\n          note?.notes ?? '',\n          actionNode\n        );\n        const documentReference = createActionDocumentReference(\n          noteString,\n          actionNode.label,\n          patient\n        );\n\n        newPatientRecords.push(documentReference);\n        client?.create?.(documentReference);\n      }\n\n      // Translate pathway recommended resource and add to patient record\n      if (note?.status === 'Accepted' && action?.resource) {\n        const resource: Resource = translatePathwayRecommendation(\n          action.resource,\n          patient.id as string\n        );\n\n        newPatientRecords.push(resource);\n        client?.create?.(resource);\n      }\n\n      setPatientRecords(newPatientRecords);\n      setShowReport(false);\n    };\n\n    const onAdvance = (): void => {\n      const content = `${actionNode.label} - Advance`;\n      const documentReference = createDocumentReference(content, patient);\n\n      client?.create?.(documentReference);\n      setPatientRecords([...patientRecords, documentReference]);\n    };\n\n    return (\n      <>\n        <ExpandedNodeMemo\n          isAction={isAction}\n          isActionable={isActionable}\n          isCurrentNode={isCurrentNode}\n          actionNode={actionNode}\n          documentation={documentation}\n          setComments={setComments}\n          comments={note?.notes ?? ''}\n          onAccept={(): void => {\n            setNote(prevNote => {\n              return { ...prevNote, status: 'Accepted' };\n            });\n            setShowReport(true);\n          }}\n          onDecline={(): void => {\n            setNote(prevNote => {\n              return { ...prevNote, status: 'Declined' };\n            });\n            setShowReport(true);\n          }}\n          isAccepted={isAccepted}\n          onAdvance={onAdvance}\n        />\n        {showReport && (\n          <ReportModal\n            onConfirm={(): void => onConfirm(actionNode.action)}\n            onDecline={(): void => setShowReport(false)}\n          />\n        )}\n      </>\n    );\n  }\n);\n\ntype ExpandedNodeFieldProps = {\n  title: string;\n  description: ReactNode;\n};\n\nconst ExpandedNodeField: FC<ExpandedNodeFieldProps> = ({ title, description }) => {\n  return (\n    <tr>\n      <td className={styles.descTitle}>{title}</td>\n      <td className={styles.desc}>{description}</td>\n    </tr>\n  );\n};\n\ntype StatusFieldProps = {\n  documentation: DocumentationResource | undefined;\n  isAccepted: boolean | null;\n};\n\nconst StatusField: FC<StatusFieldProps> = ({ documentation, isAccepted }) => {\n  if (!documentation?.resource) {\n    return null;\n  }\n  const status = documentation.status;\n  const rawDate = documentation.resource?.meta?.lastUpdated;\n  if (rawDate) {\n    const date = new Date(rawDate).toLocaleString('en-us');\n    let titleText = '';\n    if (isAccepted) {\n      titleText = status.charAt(0).toUpperCase() + status.slice(1);\n    } else if (isAccepted === null) {\n      titleText = 'Status';\n    } else {\n      titleText = 'Declined';\n    }\n    return (\n      <ExpandedNodeField\n        key=\"Status\"\n        title={titleText}\n        description={isAccepted ? date : date.concat(' by Dr. Example')}\n      />\n    );\n  }\n  return null;\n};\n\nfunction renderBranch(\n  documentation: DocumentationResource | undefined,\n  pathwayNode: PathwayNode,\n  isAccepted: boolean | null\n): ReactElement[] {\n  const returnElements: ReactElement[] = [];\n\n  if (documentation?.resource) {\n    switch (documentation.resourceType) {\n      case 'Observation': {\n        const observation = documentation.resource as Observation;\n\n        const valueCoding = observation.valueCodeableConcept?.coding;\n        if (valueCoding) {\n          returnElements.push(\n            <ExpandedNodeField\n              key=\"ValueSystem\"\n              title=\"System\"\n              description={\n                <>\n                  {valueCoding[0].system}\n                  <a href={valueCoding[0].system} target=\"_blank\" rel=\"noopener noreferrer\">\n                    <FontAwesomeIcon icon={faExternalLinkAlt} className={styles.externalLink} />\n                  </a>\n                </>\n              }\n            />,\n            <ExpandedNodeField key=\"ValueCode\" title=\"Code\" description={valueCoding[0].code} />,\n            <ExpandedNodeField\n              key=\"ValueDisplay\"\n              title=\"Display\"\n              description={valueCoding[0].display}\n            />\n          );\n        }\n\n        const date = observation.effectiveDateTime;\n        if (date) {\n          returnElements.push(\n            <ExpandedNodeField\n              key=\"Date\"\n              title=\"Date\"\n              description={new Date(date).toLocaleString('en-us')}\n            />\n          );\n        }\n        break;\n      }\n      case 'DocumentReference': {\n        const documentReference = documentation.resource as DocumentReference;\n        const subject = documentReference.subject;\n        if (subject)\n          returnElements.push(\n            <ExpandedNodeField key=\"subject\" title=\"Subject\" description={subject.reference} />\n          );\n\n        // Display missing data value if it is available, otherwise display note content\n        const identifierArray: Identifier[] | undefined = documentReference.identifier;\n        const documentReferenceIdentifier = identifierArray?.find(\n          i => i.system === 'pathways.documentreference'\n        );\n\n        if (documentReferenceIdentifier) {\n          const value = atob(documentReferenceIdentifier.value as string);\n          returnElements.push(<ExpandedNodeField key=\"value\" title=\"Value\" description={value} />);\n        } else {\n          const note = documentReference.content[0].attachment.data;\n          if (note)\n            returnElements.push(\n              <ExpandedNodeField key=\"note\" title=\"Note\" description={atob(note)} />\n            );\n        }\n        break;\n      }\n      default: {\n        returnElements.push(\n          <ExpandedNodeField key=\"error\" title=\"Error\" description=\"Unsupported Resource Type\" />\n        );\n      }\n    }\n  } else {\n    const values: string[] = pathwayNode.transitions\n      .map(transition => {\n        const description = transition.condition?.description;\n        return description ? description : '';\n      })\n      // Remove duplicate values\n      .filter((v, i, arr) => arr.indexOf(v) === i);\n\n    returnElements.push(\n      <ExpandedNodeField\n        key=\"value\"\n        title=\"Value\"\n        description={<MissingDataPopup values={values} />}\n      />\n    );\n  }\n  return returnElements;\n}\n\nfunction isMedicationRequest(\n  request: MedicationRequest | ServiceRequest | CarePlan\n): request is MedicationRequest {\n  return (request as MedicationRequest)?.medicationCodeableConcept !== undefined;\n}\n\nfunction isServiceRequest(\n  request: MedicationRequest | ServiceRequest | CarePlan\n): request is ServiceRequest {\n  return (request as ServiceRequest)?.code !== undefined;\n}\n\nfunction renderAction(\n  actionNode: ActionNode,\n  documentation: DocumentationResource | undefined,\n  isAccepted: boolean | null\n): ReactElement[] {\n  const resource = actionNode.action.resource;\n  let coding = undefined;\n\n  if (isMedicationRequest(resource)) {\n    coding = resource?.medicationCodeableConcept?.coding;\n  } else if (isServiceRequest(resource)) {\n    coding = resource?.code?.coding;\n  } else {\n    // CarePlans don't have codes. we can hack one up from the name\n    coding = [{ display: resource?.title }];\n  }\n\n  const returnElements = [\n    <ExpandedNodeField\n      key=\"Description\"\n      title=\"Description\"\n      description={actionNode.action.description}\n    />,\n    <ExpandedNodeField key=\"Type\" title=\"Type\" description={resource.resourceType} />\n  ];\n\n  if (coding) {\n    const elements = [\n      <ExpandedNodeField\n        key=\"System\"\n        title=\"System\"\n        description={\n          <>\n            {coding && coding[0].system}\n            <a href={coding && coding[0].system} target=\"_blank\" rel=\"noopener noreferrer\">\n              <FontAwesomeIcon icon={faExternalLinkAlt} className={styles.externalLink} />\n            </a>\n          </>\n        }\n      />,\n      <ExpandedNodeField key=\"Code\" title=\"Code\" description={coding && coding[0].code} />,\n      <ExpandedNodeField key=\"Display\" title=\"Display\" description={coding && coding[0].display} />\n    ];\n    returnElements.push(...elements);\n  }\n  if (documentation?.resource) {\n    switch (documentation.resourceType) {\n      case 'Procedure': {\n        const procedure = documentation.resource as Procedure;\n        const start =\n          (procedure.performedPeriod && procedure.performedPeriod.start) ||\n          procedure.performedDateTime;\n        const end = procedure.performedPeriod && procedure.performedPeriod.end;\n        if (start) {\n          returnElements.push(\n            <ExpandedNodeField\n              key=\"Start\"\n              title=\"Start\"\n              description={new Date(start).toLocaleString('en-us')}\n            />\n          );\n        }\n\n        if (end) {\n          returnElements.push(\n            <ExpandedNodeField\n              key=\"End\"\n              title=\"End\"\n              description={new Date(end).toLocaleString('en-us')}\n            />\n          );\n        }\n        break;\n      }\n      case 'CarePlan': {\n        const plan = documentation.resource as CarePlan;\n        const title = plan.title;\n        if (title) {\n          returnElements.push(<ExpandedNodeField key=\"Title\" title=\"Title\" description={title} />);\n        }\n      }\n    }\n  }\n  return returnElements;\n}\n\ninterface ExpandedNodeMemoProps {\n  documentation: DocumentationResource | undefined;\n  actionNode: ActionNode;\n  isAction: boolean;\n  isActionable: boolean;\n  isCurrentNode: boolean;\n  comments: string;\n  setComments: (value: string) => void;\n  onAccept: () => void;\n  onDecline: () => void;\n  isAccepted: boolean | null;\n  onAdvance: () => void;\n}\nconst ExpandedNodeMemo: FC<ExpandedNodeMemoProps> = memo(\n  ({\n    documentation,\n    actionNode,\n    isAction,\n    isActionable,\n    isCurrentNode,\n    comments,\n    setComments,\n    onAccept,\n    onDecline,\n    isAccepted,\n    onAdvance\n  }) => {\n    const { patientRecords } = usePatientRecords();\n    const action = isAction && renderAction(actionNode, documentation, isAccepted);\n    const branch = isBranchNode(actionNode) && renderBranch(documentation, actionNode, isAccepted);\n    const defaultText =\n      'The patient and I discussed the treatment plan, risks, benefits and alternatives.  The patient expressed understanding and wants to proceed.';\n\n    let notes;\n    const documentReference = retrieveNote(actionNode.label, patientRecords);\n    if (documentReference) {\n      const content = documentReference.content[0].attachment?.data;\n      if (content) {\n        notes = atob(content);\n        notes = notes.slice(notes.indexOf('Notes: ') + 7);\n      }\n    }\n\n    return (\n      <div className={indexStyles.expandedNode}>\n        <table className={styles.infoTable}>\n          <tbody>\n            <StatusField documentation={documentation} isAccepted={isAccepted} />\n            {action || branch}\n            {!isActionable && notes && /\\S/.test(notes) && (\n              <ExpandedNodeField key=\"Comments\" title=\"Comments\" description={notes} />\n            )}\n          </tbody>\n        </table>\n        {/* Node is advanceable if it has been accepted or declined */}\n        {actionNode.transitions.length > 0 && !isActionable && isAction && isCurrentNode && (\n          <Button\n            className={`${indexStyles.button} ${styles.button}`}\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={onAdvance}\n          >\n            Advance\n          </Button>\n        )}\n        {isActionable && isAction && (\n          <form className={styles.commentsForm}>\n            <div>\n              <label>Comments:</label>\n              <Button\n                className={`${indexStyles.button} ${styles.button}`}\n                onClick={(e): void => {\n                  e.preventDefault();\n                  if (!comments.includes(defaultText)) setComments(comments + defaultText);\n                }}\n                variant=\"contained\"\n                color=\"primary\"\n              >\n                Use Default Text\n              </Button>\n            </div>\n            <textarea\n              className={styles.comments}\n              value={comments}\n              onChange={(e): void => setComments(e.target.value)}\n            ></textarea>\n            <div className={styles.footer}>\n              <ActionButton type=\"accept\" size=\"large\" onClick={onAccept} />\n            </div>\n            <div className={styles.footer}>\n              <ActionButton type=\"decline\" size=\"large\" onClick={onDecline} />\n            </div>\n          </form>\n        )}\n      </div>\n    );\n  }\n);\n\nexport default ExpandedNode;\n","import { PathwayNode } from 'pathways-model';\n\nexport function isActionNode(node: PathwayNode): boolean {\n  return node.type === 'action';\n}\n\nexport function isBranchNode(node: PathwayNode): boolean {\n  return node.type === 'branch';\n}\n","import React, { FC, Ref, forwardRef, memo } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport clsx from 'clsx';\nimport { ActionNode, PathwayNode, DocumentationResource } from 'pathways-model';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport styles from './Node.module.scss';\nimport nodeStyles from 'styles/index.module.scss';\nimport ExpandedNode from 'components/ExpandedNode';\nimport { isActionNode } from 'utils/nodeUtils';\nimport { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport {\n  faMicroscope,\n  faPlay,\n  faPrescriptionBottleAlt,\n  faSyringe,\n  faCheckCircle,\n  faTimesCircle,\n  faBookMedical\n} from '@fortawesome/free-solid-svg-icons';\n\nconst useStyles = makeStyles(\n  theme => ({\n    'not-on-patient-path': {\n      backgroundColor: theme.palette.background.default,\n      color: theme.palette.text.primary\n    },\n    'child-not-on-patient-path': {\n      borderColor: theme.palette.background.default\n    }\n  }),\n  { name: 'Node' }\n);\n\ninterface NodeProps {\n  pathwayNode: PathwayNode;\n  documentation: DocumentationResource | undefined;\n  isOnPatientPath: boolean;\n  isCurrentNode: boolean;\n  xCoordinate: number;\n  yCoordinate: number;\n  expanded?: boolean;\n  onClickHandler?: () => void;\n}\n\nconst Node: FC<NodeProps & { ref: Ref<HTMLDivElement> }> = memo(\n  forwardRef<HTMLDivElement, NodeProps>(\n    (\n      {\n        pathwayNode,\n        documentation,\n        isOnPatientPath,\n        isCurrentNode,\n        xCoordinate,\n        yCoordinate,\n        expanded = false,\n        onClickHandler\n      },\n      ref\n    ) => {\n      const { label } = pathwayNode;\n      const style = {\n        top: yCoordinate,\n        left: xCoordinate\n      };\n      const classes = useStyles();\n      const backgroundColorClass = isOnPatientPath\n        ? styles.onPatientPath\n        : clsx(styles.notOnPatientPath, classes['not-on-patient-path']);\n      const isActionable = isCurrentNode && !documentation;\n      const topLevelClasses = [styles.node, backgroundColorClass];\n      let expandedNodeClass = '';\n      if (expanded) topLevelClasses.push(nodeStyles.expanded);\n      if (isActionable) {\n        topLevelClasses.push(styles.actionable);\n        expandedNodeClass = styles.childActionable;\n      } else {\n        expandedNodeClass = isOnPatientPath\n          ? styles.childOnPatientPath\n          : clsx(styles.childNotOnPatientPath, classes['child-not-on-patient-path']);\n      }\n\n      const isAction = isActionNode(pathwayNode);\n      // TODO: how do we determine whether a node has been accepted or declined?\n      // for now:\n      // if it's a non-actionable action node on the path: accepted == has documentation\n      // if it's actionable, not action or not on the path: null\n      const wasActionTaken = isOnPatientPath && isAction && !isActionable;\n      const isAccepted = wasActionTaken\n        ? documentation?.resourceType !== 'DocumentReference'\n        : null;\n      if (isAccepted === false) {\n        topLevelClasses.push(styles.declined);\n        if (expanded) expandedNodeClass = styles.childDeclined;\n      }\n      let status = null;\n      if ('action' in pathwayNode) {\n        if (isOnPatientPath) status = isAccepted;\n        else status = isAction && documentation ? true : null;\n      } else if (!isCurrentNode && documentation) {\n        status = true;\n      }\n\n      return (\n        <div className={topLevelClasses.join(' ')} style={style} ref={ref}>\n          <div\n            className={`${nodeStyles.nodeTitle} ${onClickHandler && nodeStyles.clickable}`}\n            onClick={onClickHandler}\n          >\n            <div className={nodeStyles.iconAndLabel}>\n              <NodeIcon pathwayNode={pathwayNode} isAction={isAction} />\n              {label}\n            </div>\n            <StatusIcon status={status} />\n          </div>\n          {expanded && (\n            <div className={`${styles.expandedNode} ${expandedNodeClass}`}>\n              <ExpandedNode\n                actionNode={pathwayNode as ActionNode}\n                isActionable={isActionable}\n                isAction={isAction}\n                documentation={documentation}\n                isAccepted={isAccepted}\n                isCurrentNode={isCurrentNode}\n              />\n            </div>\n          )}\n        </div>\n      );\n    }\n  )\n);\n\ninterface NodeIconProps {\n  pathwayNode: PathwayNode;\n  isAction: boolean;\n}\n\nconst NodeIcon: FC<NodeIconProps> = ({ pathwayNode, isAction }) => {\n  let icon: IconProp = faMicroscope;\n  if (pathwayNode.label === 'Start') icon = faPlay;\n  if (isAction) {\n    const actionNode = pathwayNode as ActionNode;\n    if (actionNode.action) {\n      const resourceType = actionNode.action.resource.resourceType;\n      if (resourceType === 'MedicationRequest') icon = faPrescriptionBottleAlt;\n      else if (resourceType === 'ServiceRequest') icon = faSyringe;\n      else if (resourceType === 'CarePlan') icon = faBookMedical;\n    }\n  }\n  return <FontAwesomeIcon icon={icon} className={styles.icon} />;\n};\n\ninterface StatusIconProps {\n  status: boolean | null;\n}\n\nconst StatusIcon: FC<StatusIconProps> = ({ status }) => {\n  if (status === null) return null;\n  const icon = status ? faCheckCircle : faTimesCircle;\n  return <FontAwesomeIcon icon={icon} className={styles.statusIcon} />;\n};\n\nexport default Node;\n","import React, { FC } from 'react';\nimport { Edge, Coordinate } from 'graph-model';\nimport styles from './Arrow.module.scss';\n\ninterface ArrowProps {\n  edge: Edge;\n  edgeName: string;\n  isOnPatientPath: boolean;\n  widthOffset: number;\n}\n\ninterface ArrowPathProps {\n  points: Coordinate[];\n  arrowheadId: string;\n  widthOffset: number;\n}\n\nconst Arrow: FC<ArrowProps> = ({ edge, edgeName, isOnPatientPath, widthOffset }) => {\n  const className = isOnPatientPath ? styles.arrowOnPatientPath : styles.arrow;\n  const edgeNameNoWhitespace = edgeName.replace(' ', '');\n  const arrowheadId = `arrowhead-${edgeNameNoWhitespace}`;\n\n  const { label } = edge;\n  return (\n    <svg className={className}>\n      <ArrowPath points={edge.points} arrowheadId={arrowheadId} widthOffset={widthOffset} />\n      {label ? (\n        <text x={label.x + widthOffset} y={label.y}>\n          {label.text}\n        </text>\n      ) : null}\n      <defs>\n        <marker\n          id={arrowheadId}\n          className={styles.arrowhead}\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"0\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon points=\"0 0, 10 3.5, 0 7\" />\n        </marker>\n      </defs>\n    </svg>\n  );\n};\n\n// Returns path for arrow from edge points\nconst ArrowPath: FC<ArrowPathProps> = ({ points, arrowheadId, widthOffset }) => {\n  const pointsWithOffset = points.map(p => ({ x: p.x + widthOffset, y: p.y }));\n  const length = pointsWithOffset.length;\n  pointsWithOffset[length - 1].y -= 17.5;\n  let pathString = `M ${pointsWithOffset[0].x} ${pointsWithOffset[0].y} `;\n\n  /**\n   * The points to use in the Cubic command is determined by the length of points array\n   * If i % 3 is 0, use all points including the 1st point\n   * If i % 3 is 1, use all points except the 1st point\n   * If i % 3 is 2, use all points including the 1st point and reuse every 3rd point\n   * We need points to be a multiple of 3 because the Cubic command expects 3 points\n   */\n  const writeCommandString = (remainder: number): string => {\n    return pointsWithOffset.reduce((acc, point, i, arr) => {\n      return i % 3 !== remainder\n        ? acc\n        : `${acc} C ${point.x} ${point.y} ${arr[i + 1].x} ${arr[i + 1].y} ${arr[i + 2].x}\n        ${arr[i + 2].y}`;\n    }, pathString);\n  };\n\n  pathString = writeCommandString(length % 3);\n\n  return <path d={pathString} fill=\"transparent\" markerEnd={`url(#${arrowheadId})`} />;\n};\n\nexport default Arrow;\n","import React, {\n  FC,\n  RefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  memo\n} from 'react';\n\nimport graphLayout from 'visualization/layout';\nimport Node from 'components/Node';\nimport Arrow from 'components/Arrow';\nimport { evaluatePatientOnPathway } from 'engine';\nimport {\n  EvaluatedPathway,\n  PathwayResults,\n  DocumentationResource,\n  Pathway,\n  Documentation\n} from 'pathways-model';\nimport { Layout, NodeDimensions, NodeCoordinates, Edges, Edge } from 'graph-model';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport { DomainResource } from 'fhir-objects';\nimport styles from './Graph.module.scss';\nimport ResizeSensor from 'css-element-queries/src/ResizeSensor';\nimport { NoteDataProvider } from 'components/NoteDataProvider';\nimport { usePathwayContext } from 'components/PathwayProvider';\n\ninterface GraphProps {\n  evaluatedPathway?: EvaluatedPathway;\n  interactive?: boolean;\n  expandCurrentNode?: boolean;\n}\n\nconst getPath = (pathwayResults: PathwayResults): string[] => {\n  return Object.values(pathwayResults.documentation)\n    .filter(doc => doc.onPath)\n    .map(doc => doc.node);\n};\n\nconst isEdgeOnPatientPath = (pathwayResults: PathwayResults, edge: Edge): boolean => {\n  const path = getPath(pathwayResults);\n  const startIndex = path.indexOf(edge.start);\n  const endIndex = path.indexOf(edge.end);\n  if (startIndex !== -1 && endIndex !== -1 && startIndex + 1 === endIndex) return true;\n  else if (startIndex === path.length - 1 && pathwayResults.currentNodes.includes(edge.end))\n    return true;\n  else return false;\n};\n\nconst Graph: FC<GraphProps> = memo(\n  ({ evaluatedPathway, interactive = true, expandCurrentNode = true }) => {\n    const pathwayCtx = usePathwayContext();\n    if (!evaluatedPathway) {\n      if (!pathwayCtx.evaluatedPathway) return <div>No Pathway Loaded</div>;\n      else evaluatedPathway = pathwayCtx.evaluatedPathway;\n    }\n\n    const patientRecords = usePatientRecords();\n    const resources = patientRecords.patientRecords;\n    const pathway = evaluatedPathway.pathway;\n    const graphElement = useRef<HTMLDivElement>(null);\n    const nodeRefs = useRef<{ [key: string]: HTMLDivElement }>({});\n    const [parentWidth, setParentWidth] = useState<number>(\n      graphElement?.current?.parentElement?.clientWidth ?? 0\n    );\n\n    const setPath = useCallback(\n      (value: PathwayResults): void => {\n        patientRecords.setEvaluatePath(false);\n        pathwayCtx.updateEvaluatedPathways({\n          pathway: pathway,\n          pathwayResults: value\n        });\n      },\n      [pathway, pathwayCtx, patientRecords]\n    );\n\n    // Get the layout of the graph\n    const getGraphLayout = useCallback((): Layout => {\n      const nodeDimensions: NodeDimensions = {};\n\n      // Retrieve dimensions from nodeRefs\n      if (nodeRefs?.current) {\n        Object.keys(nodeRefs.current).forEach(key => {\n          const nodeElement = nodeRefs.current[key];\n          const width = nodeElement.clientWidth;\n          // nodeElement can have multiple children so calculate the sum to get the node height\n          const height = Array.from(nodeElement.children).reduce(\n            (acc, child) => acc + child.clientHeight,\n            0\n          );\n\n          nodeDimensions[key] = { width, height };\n        });\n      }\n\n      return graphLayout(pathway, nodeDimensions);\n    }, [pathway]);\n\n    const [layout, setLayout] = useState(getGraphLayout());\n    const { nodeCoordinates, edges } = layout;\n    const maxHeight = useMemo(() => {\n      return nodeCoordinates !== undefined\n        ? Object.values(nodeCoordinates)\n            .map(x => x.y)\n            .reduce((a, b) => Math.max(a, b))\n        : 0;\n    }, [nodeCoordinates]);\n\n    // If a node has a negative x value, shift nodes and edges to the right by that value\n    const minX =\n      nodeCoordinates !== undefined\n        ? Object.values(nodeCoordinates)\n            .map(x => x.x + parentWidth / 2)\n            .reduce((a, b) => Math.min(a, b))\n        : 0;\n\n    if (minX < 0) {\n      const toAdd = minX * -1;\n      Object.keys(nodeCoordinates).forEach(key => {\n        const node = nodeCoordinates[key];\n        node.x += toAdd;\n      });\n\n      Object.keys(edges).forEach(key => {\n        const edge = edges[key];\n\n        edge.points.forEach(p => (p.x += toAdd));\n        if (edge.label) edge.label.x += toAdd;\n      });\n    }\n    const layoutKeys = Object.keys(layout).toString();\n    const initialExpandedNode = useMemo(() => {\n      return layoutKeys.split(',').reduce((acc: { [key: string]: boolean }, curr: string) => {\n        acc[curr] = false;\n        return acc;\n      }, {});\n    }, [layoutKeys]);\n\n    const [expanded, _setExpanded] = useState<{ [key: string]: boolean | undefined }>(\n      initialExpandedNode\n    );\n\n    const setExpanded = useCallback((key: string, expand?: boolean): void => {\n      _setExpanded(prevState => {\n        return { ...prevState, [key]: expand ?? !prevState[key] };\n      });\n    }, []);\n\n    // Evaluate patient on the pathway\n    useEffect(() => {\n      // Keeps track of whether the current useEffect cycle has ended\n      let cancel = false;\n\n      if (\n        resources.length > 0 &&\n        (!evaluatedPathway?.pathwayResults || patientRecords.evaluatePath)\n      ) {\n        // Create a Bundle for the CQL engine and check if patientPath needs to be evaluated\n        const patient = {\n          resourceType: 'Bundle',\n          type: 'searchset',\n          entry: resources.map((r: DomainResource) => ({ resource: r }))\n        };\n        evaluatePatientOnPathway(patient, pathway, resources).then(pathwayResults => {\n          if (!cancel) setPath(pathwayResults);\n        });\n\n        return (): void => {\n          cancel = true;\n        };\n      }\n    }, [pathway, resources, evaluatedPathway, setPath, patientRecords]);\n\n    // Expand all the current nodes by default if allowed\n    useEffect(() => {\n      if (evaluatedPathway?.pathwayResults) {\n        for (const currentNode of evaluatedPathway.pathwayResults.currentNodes) {\n          if (expandCurrentNode) {\n            if (currentNode) setExpanded(currentNode, true);\n          }\n        }\n      }\n    }, [expandCurrentNode, evaluatedPathway, setExpanded]);\n\n    // Recalculate graph layout if graph container size changes\n    useEffect(() => {\n      if (graphElement.current?.parentElement) {\n        new ResizeSensor(graphElement.current.parentElement, function() {\n          setParentWidth(graphElement.current?.parentElement?.clientWidth ?? 0);\n          setLayout(getGraphLayout());\n        });\n      }\n    }, [getGraphLayout]);\n\n    // Recalculate graph layout if a node is expanded\n    useEffect(() => {\n      setLayout(getGraphLayout());\n    }, [expanded, getGraphLayout]);\n\n    // maxWidth finds the edge label that is farthest to the right\n    const maxWidth: number =\n      edges !== undefined\n        ? Object.values(edges)\n            .map(e => e.label)\n            .map(l => (l ? l.x + l.text.length * 10 + parentWidth / 2 : 0))\n            .reduce((a, b) => Math.max(a, b), 0)\n        : parentWidth;\n\n    const documentation = evaluatedPathway.pathwayResults\n      ? evaluatedPathway.pathwayResults.documentation\n      : {};\n\n    return (\n      <GraphMemo\n        graphElement={graphElement}\n        interactive={interactive}\n        maxHeight={maxHeight}\n        nodeCoordinates={nodeCoordinates}\n        documentation={documentation}\n        edges={edges}\n        evaluatedPathway={evaluatedPathway}\n        nodeRefs={nodeRefs}\n        parentWidth={parentWidth}\n        maxWidth={maxWidth}\n        pathway={pathway}\n        expanded={expanded}\n        setExpanded={setExpanded}\n      />\n    );\n  }\n);\n\ninterface GraphMemoProps {\n  graphElement: RefObject<HTMLDivElement>;\n  interactive: boolean;\n  maxHeight: number;\n  nodeCoordinates: NodeCoordinates;\n  documentation: { [key: string]: Documentation };\n  edges: Edges;\n  evaluatedPathway: EvaluatedPathway;\n  nodeRefs: React.MutableRefObject<{\n    [key: string]: HTMLDivElement;\n  }>;\n  parentWidth: number;\n  maxWidth: number;\n  pathway: Pathway;\n  expanded: {\n    [key: string]: boolean | undefined;\n  };\n  setExpanded: (key: string, expand?: boolean | undefined) => void;\n}\n\nconst GraphMemo: FC<GraphMemoProps> = memo(\n  ({\n    graphElement,\n    interactive,\n    maxHeight,\n    nodeCoordinates,\n    documentation,\n    edges,\n    evaluatedPathway,\n    nodeRefs,\n    parentWidth,\n    maxWidth,\n    pathway,\n    expanded,\n    setExpanded\n  }) => {\n    return (\n      <div\n        ref={graphElement}\n        id=\"graph-root\"\n        className={styles.root}\n        style={{\n          height: interactive ? maxHeight + 150 : 'inherit',\n          width: maxWidth + 'px',\n          position: 'relative',\n          marginRight: '5px'\n        }}\n      >\n        {nodeCoordinates !== undefined\n          ? Object.keys(nodeCoordinates).map(nodeKey => {\n              const docResource = documentation[nodeKey] as DocumentationResource;\n              const onClickHandler = useCallback(() => {\n                return interactive ? setExpanded(nodeKey) : undefined;\n              }, [nodeKey]);\n              return (\n                <NoteDataProvider date={new Date(Date.now())} key={nodeKey}>\n                  <Node\n                    key={nodeKey}\n                    documentation={docResource}\n                    ref={(node: HTMLDivElement): void => {\n                      nodeRefs.current[nodeKey] = node;\n                    }}\n                    pathwayNode={pathway.nodes[nodeKey]}\n                    isOnPatientPath={\n                      evaluatedPathway.pathwayResults\n                        ? getPath(evaluatedPathway.pathwayResults).includes(nodeKey) ||\n                          evaluatedPathway.pathwayResults.currentNodes.includes(nodeKey)\n                        : false\n                    }\n                    isCurrentNode={\n                      evaluatedPathway.pathwayResults\n                        ? evaluatedPathway.pathwayResults.currentNodes.includes(nodeKey)\n                        : false\n                    }\n                    xCoordinate={nodeCoordinates[nodeKey].x + parentWidth / 2}\n                    yCoordinate={nodeCoordinates[nodeKey].y}\n                    expanded={expanded[nodeKey]}\n                    onClickHandler={onClickHandler}\n                  />\n                </NoteDataProvider>\n              );\n            })\n          : []}\n\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          style={{\n            // Adding 5 pixels to maxWidth so that the rightmost edge label is not cut off\n            width: maxWidth + 5,\n            height: maxHeight,\n            zIndex: 1,\n            top: 0,\n            left: 0,\n            overflow: 'visible'\n          }}\n        >\n          {edges !== undefined\n            ? Object.keys(edges).map(edgeName => {\n                const edge = edges[edgeName];\n                return (\n                  <Arrow\n                    key={edgeName}\n                    edge={edge}\n                    edgeName={edgeName}\n                    isOnPatientPath={\n                      evaluatedPathway.pathwayResults\n                        ? isEdgeOnPatientPath(evaluatedPathway.pathwayResults, edge)\n                        : false\n                    }\n                    widthOffset={parentWidth / 2}\n                  />\n                );\n              })\n            : []}\n        </svg>\n      </div>\n    );\n  }\n);\n\nexport default Graph;\n","import React, { FC, ReactNode, useState, RefObject } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport clsx from 'clsx';\nimport { Service } from 'pathways-objects';\nimport { Pathway, EvaluatedPathway, PreconditionResult } from 'pathways-model';\n\nimport styles from './PathwaysList.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport Graph from 'components/Graph';\nimport { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport { usePathwayContext } from 'components/PathwayProvider';\nimport { evaluatePathwayPreconditions } from 'engine';\nimport { usePatientRecords } from 'components/PatientRecordsProvider';\nimport { getAssignedPathways } from 'utils/fhirUtils';\nimport {\n  faEye,\n  faPlay,\n  faPlus,\n  faMinus,\n  faChevronUp,\n  faChevronDown,\n  faCaretDown,\n  faCheckCircle,\n  faTimesCircle\n} from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nconst useStyles = makeStyles(\n  theme => ({\n    'pathway-element': {\n      backgroundColor: theme.palette.background.default\n    },\n    'assigned-pathway-element': {\n      backgroundColor: theme.palette.primary.main\n    },\n    title: {\n      color: theme.palette.text.primary\n    },\n    'assigned-title': {\n      color: theme.palette.common.white\n    }\n  }),\n  { name: 'PathwaysList' }\n);\n\ninterface PathwaysListElementProps {\n  evaluatedPathway: EvaluatedPathway;\n  preconditions?: PreconditionResult;\n  callback: Function;\n  assigned: boolean;\n}\n\ninterface PathwaysListProps {\n  evaluatedPathways: EvaluatedPathway[];\n  callback: Function;\n  service: Service<Array<Pathway>>;\n  headerElement: RefObject<HTMLDivElement>;\n}\n\nconst PathwaysList: FC<PathwaysListProps> = ({\n  evaluatedPathways,\n  callback,\n  service,\n  headerElement\n}) => {\n  const { patientRecords } = usePatientRecords();\n  const [preconditions, setPreconditions] = useState<PreconditionResult[] | null>(null);\n\n  if (\n    !preconditions &&\n    evaluatedPathways.length > 0 &&\n    patientRecords &&\n    patientRecords.length > 0\n  ) {\n    // Create a Bundle for the CQL engine and check if patientPath needs to be evaluated\n    const patient = {\n      resourceType: 'Bundle',\n      type: 'searchset',\n      entry: patientRecords.map((r: fhir.Resource) => ({ resource: r }))\n    };\n\n    // Evaluate pathway preconditions for each pathway\n    const preconditionPromises = evaluatedPathways.map(pathway =>\n      evaluatePathwayPreconditions(patient, pathway.pathway)\n    );\n    Promise.all(preconditionPromises).then(preconditionResults => {\n      setPreconditions(preconditionResults.sort((a, b) => b.matches - a.matches));\n    });\n  }\n\n  function renderList(): ReactNode {\n    return (\n      <div>\n        {preconditions ? (\n          preconditions.map(c => {\n            const evaluatedPathway = evaluatedPathways.find(p => p.pathway.name === c.pathwayName);\n            if (evaluatedPathway) {\n              const pathwayName = evaluatedPathway.pathway.name;\n              return (\n                <PathwaysListElement\n                  evaluatedPathway={evaluatedPathway}\n                  callback={callback}\n                  preconditions={c}\n                  assigned={assignedPathways.includes(pathwayName)}\n                  key={pathwayName}\n                />\n              );\n            } else\n              return (\n                <div>An error occured evaluating the pathway preconditions. Please try again.</div>\n              );\n          })\n        ) : (\n          <div>Loading Pathways...</div>\n        )}\n      </div>\n    );\n  }\n\n  const assignedPathways = getAssignedPathways(patientRecords, evaluatedPathways);\n  const style = { height: '100%' };\n  if (headerElement?.current) {\n    style.height = window.innerHeight - headerElement.current.clientHeight + 'px';\n  }\n  return (\n    <div className={styles.pathways_list} style={style}>\n      {service.status === 'loading' ? (\n        <div>Loading...</div>\n      ) : service.status === 'loaded' ? (\n        <div className={styles.container}>\n          <div className={styles.pathwayListHeaderContainer}>\n            <div className={styles.header_title}>\n              <div className={styles.header_title__header}>Explore Pathways</div>\n              <div className={styles.header_title__note}>Select pathway below to view details</div>\n            </div>\n            <div className={styles.matchedElementsLabel}>\n              <i>\n                mCODE\n                <br />\n                elements\n                <br />\n                matched\n              </i>\n              <FontAwesomeIcon icon={faCaretDown} />\n            </div>\n          </div>\n\n          {preconditions?.length !== 0 && renderList()}\n        </div>\n      ) : (\n        <div>ERROR</div>\n      )}\n    </div>\n  );\n};\n\nconst PathwaysListElement: FC<PathwaysListElementProps> = ({\n  evaluatedPathway,\n  preconditions,\n  callback,\n  assigned\n}) => {\n  const classes = useStyles();\n  const pathway = evaluatedPathway.pathway;\n  const { setEvaluatedPathway, assignPathway, unassignPathway } = usePathwayContext();\n  const [isVisible, setIsVisible] = useState<boolean>(false);\n\n  const chevron: IconProp = isVisible ? faChevronUp : faChevronDown;\n\n  function toggleVisible(): void {\n    setIsVisible(!isVisible);\n  }\n\n  const pathwayElementClass = clsx(\n    assigned && styles.assignedPathwayElement,\n    assigned && classes['assigned-pathway-element'],\n    !assigned && styles.pathwayElement,\n    !assigned && classes['pathway-element']\n  );\n\n  const titleClass = clsx(\n    styles.title,\n    assigned && classes['assigned-title'],\n    !assigned && classes.title\n  );\n\n  return (\n    <div className={pathwayElementClass} role={'list'} key={pathway.name}>\n      <div\n        className={titleClass}\n        role={'listitem'}\n        onClick={(e): void => {\n          setEvaluatedPathway(evaluatedPathway, true);\n          toggleVisible();\n        }}\n      >\n        <div>{pathway.name}</div>\n        {assigned && <FontAwesomeIcon icon={faCheckCircle} />}\n        <div className={styles.expand}>\n          <FontAwesomeIcon icon={chevron} />\n        </div>\n        <div className={styles.numElements}>{preconditions?.matches}</div>\n      </div>\n\n      {isVisible && (\n        <div className={styles.infoContainer}>\n          <div className={styles.details}>\n            <p>{pathway.description}</p>\n            <table>\n              <tbody>\n                <tr>\n                  <th></th>\n                  <th>mCODE elements</th>\n                  <th>patient elements</th>\n                </tr>\n                {preconditions?.preconditionResultItems.map(c => (\n                  <tr key={c.elementName}>\n                    <td>{c.elementName}</td>\n                    <td>{c.expected}</td>\n                    <td className={c.match ? styles.matchingElement : undefined}>{c.actual}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <Button\n              onClick={(): void => {\n                assigned ? unassignPathway(pathway.name) : assignPathway(pathway.name);\n              }}\n              variant=\"contained\"\n              color={assigned ? 'secondary' : 'primary'}\n              startIcon={<FontAwesomeIcon icon={assigned ? faTimesCircle : faCheckCircle} />}\n            >\n              {assigned ? 'Unassign' : 'Assign'}\n            </Button>\n            <Button\n              onClick={(): void => {\n                callback(evaluatedPathway);\n              }}\n              variant=\"contained\"\n              color=\"primary\"\n              startIcon={<FontAwesomeIcon icon={faEye} />}\n            >\n              View\n            </Button>\n          </div>\n          <div className={styles.pathway}>\n            <div style={{ height: '100%', overflow: 'scroll' }}>\n              <Graph\n                evaluatedPathway={evaluatedPathway}\n                interactive={false}\n                expandCurrentNode={false}\n              />\n            </div>\n            <div className={styles.controls}>\n              <FontAwesomeIcon icon={faPlay} />\n              <FontAwesomeIcon icon={faPlus} />\n              <FontAwesomeIcon icon={faMinus} />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PathwaysList;\n","import { useState, useEffect } from 'react';\nimport { Service } from 'pathways-objects';\nimport { Pathway } from 'pathways-model';\n\nfunction getPathways(url: string): Promise<Response> {\n  return fetch(url, {\n    headers: {\n      Accept: 'application/json'\n    }\n  });\n}\n\nfunction typedFetch<T>(url: string, options?: object): Promise<T> {\n  return fetch(url, options).then(response => response.json() as Promise<T>);\n}\n\nconst useGetPathwaysService = (url: string): Service<Pathway[]> => {\n  const [result, setResult] = useState<Service<Array<Pathway>>>({\n    status: 'loading'\n  });\n\n  useEffect(() => {\n    getPathways(url)\n      .then(response => response.json() as Promise<Array<string>>)\n      .then(listOfFiles => listOfFiles.map(f => typedFetch<Pathway>(url + '/' + f)))\n      .then(listOfPromises => Promise.all(listOfPromises))\n      .then(pathwaysList => setResult({ status: 'loaded', payload: pathwaysList }))\n      .catch(error => setResult({ status: 'error', error }));\n  }, [url]);\n\n  return result;\n};\n\nexport default useGetPathwaysService;\n","import { Resource } from 'fhir-objects';\nclass MockedFHIRClient {\n  patient = {};\n\n  async create(): Promise<Resource> {\n    console.log('Mocked create');\n    return Promise.resolve({});\n  }\n\n  async delete(): Promise<Resource> {\n    console.log('Mocked delete');\n    return Promise.resolve({});\n  }\n}\n\nexport { MockedFHIRClient };\n","import React, { FC, useState, useEffect, useCallback, useMemo, useRef, RefObject } from 'react';\nimport Header from 'components/Header';\nimport Navigation from 'components/Navigation';\nimport { PathwaysClient } from 'pathways-client';\nimport logo from 'camino-logo-dark.png';\nimport { getPatientRecord } from 'utils/fhirExtract';\nimport { FHIRClientProvider } from './FHIRClient';\nimport { PatientProvider } from './PatientProvider';\nimport { PatientRecordsProvider } from './PatientRecordsProvider';\nimport PatientRecord from './PatientRecord/PatientRecord';\nimport Graph from './Graph';\nimport config from 'utils/ConfigManager';\nimport PathwaysList from './PathwaysList';\nimport { PathwayProvider } from './PathwayProvider';\nimport ThemeProvider from './ThemeProvider';\nimport { EvaluatedPathway } from 'pathways-model';\nimport useGetPathwaysService from './PathwaysService/PathwaysService';\nimport FHIR from 'fhirclient';\nimport { MockedFHIRClient } from 'utils/MockedFHIRClient';\nimport { getHumanName, createCarePlan } from 'utils/fhirUtils';\nimport { DomainResource, Practitioner, CarePlan } from 'fhir-objects';\nimport styles from './App.module.scss';\nimport { UserProvider } from './UserProvider';\nimport { McodeElements } from 'mcode';\nimport executeElm from 'engine/elm-executor';\ninterface AppProps {\n  demoId?: string;\n}\n\nconst App: FC<AppProps> = ({ demoId }) => {\n  const [patient, setPatient] = useState<fhir.Patient | null>(null);\n  const [patientRecords, _setPatientRecords] = useState<DomainResource[]>([]);\n  const [mcodeRecords, _setMcodeRecords] = useState<McodeElements>({});\n  const [currentPathway, setCurrentPathway] = useState<EvaluatedPathway | null>(null);\n  const [selectPathway, setSelectPathway] = useState<boolean>(true);\n  const [evaluatePath, setEvaluatePath] = useState<boolean>(false);\n  const [evaluatedPathways, setEvaluatedPathways] = useState<EvaluatedPathway[]>([]);\n  const [client, setClient] = useState<PathwaysClient | null>(null);\n  const [user, setUser] = useState<string>('');\n  const headerElement = useRef<HTMLDivElement>(null);\n  const graphContainerElement = useRef<HTMLDivElement>(null);\n\n  const setPatientRecords = useCallback((value: DomainResource[]): void => {\n    _setPatientRecords(value);\n    setEvaluatePath(true);\n  }, []);\n\n  const setMcodeRecords = useCallback((resources: DomainResource[]): void => {\n    // Create a Bundle for the CQL engine\n    const bundle = {\n      resourceType: 'Bundle',\n      type: 'searchset',\n      entry: resources.map((r: DomainResource) => ({ resource: r }))\n    };\n    getFixture('elm/mCODE.elm.json').then(elmString => {\n      const elm = JSON.parse(elmString);\n      const elmResults = executeElm(bundle, elm);\n      const patientIds = Object.keys(elmResults.patientResults);\n      const mcodeData = elmResults.patientResults[patientIds[0]];\n      const mcodeElements: McodeElements = {\n        'Primary Cancer': mcodeData['Primary Cancer Condition Value'][0] ?? undefined,\n        Laterality: mcodeData['Primary Cancer Condition Body Location Value'][0] ?? undefined,\n        'Tumor Category':\n          mcodeData['TNM Clinical Primary Tumor Category Data Value (T Category)'][0] ?? undefined,\n        'Node Category':\n          mcodeData['TNM Clinical Regional Nodes Category Data Value (N Category)'][0] ?? undefined,\n        'Metastases Category':\n          mcodeData['TNM Clinical Distant Metastases Category Data Value (M Category)'][0] ??\n          undefined,\n        'Estrogen Receptor': mcodeData['Estrogen Receptor Value'][0] ?? undefined,\n        'Progesterone Receptor': mcodeData['Progesterone Receptor Value'][0] ?? undefined,\n        'HER2 Receptor': mcodeData['HER2 Receptor Value'][0] ?? undefined\n      };\n\n      _setMcodeRecords(mcodeElements);\n    });\n  }, []);\n\n  const providerProps = useMemo(\n    () => ({\n      patientRecords,\n      setPatientRecords,\n      evaluatePath,\n      setEvaluatePath,\n      mcodeRecords,\n      setMcodeRecords\n    }),\n    [\n      patientRecords,\n      setPatientRecords,\n      evaluatePath,\n      setEvaluatePath,\n      mcodeRecords,\n      setMcodeRecords\n    ]\n  );\n\n  useEffect(() => {\n    if (!demoId) {\n      FHIR.oauth2\n        .init({\n          clientId: 'Input client id you get when you register the app',\n          scope: 'launch/patient openid profile'\n        })\n        .then(client => {\n          // TODO: MockedFHIRClient has not mocked out requests for resources yet\n          getPatientRecord(client).then((records: DomainResource[]) => {\n            // filters out values that are empty\n            // the server might return deleted\n            // resources that only include an\n            // id, meta, and resourceType\n            const values = ['id', 'meta', 'resourceType'];\n            records = records.filter(resource => {\n              return !Object.keys(resource).every(value => values.includes(value));\n            });\n\n            setPatientRecords(records);\n            setMcodeRecords(records);\n          });\n          client.patient?.read?.().then((resultPatient: fhir.Patient) => setPatient(resultPatient));\n          setClient(client);\n        });\n    } else {\n      setClient(new MockedFHIRClient());\n      const url = config.get('demoPatients') + demoId + '.json';\n      fetch(url)\n        .then(data => data.json())\n        .then(result => {\n          const resultPatient = result.find((r: DomainResource) => r.resourceType === 'Patient');\n          setPatientRecords(result);\n          setMcodeRecords(result);\n          setPatient(resultPatient);\n        });\n    }\n  }, [demoId, setPatientRecords, setMcodeRecords]);\n\n  // gather note info\n  useEffect(() => {\n    client?.user?.read().then((user: Practitioner) => {\n      const name = user.name && getHumanName(user.name);\n      if (name) {\n        setUser(name);\n      }\n    });\n  }, [client]);\n\n  const service = useGetPathwaysService(\n    config.get(demoId ? 'demoPathwaysService' : 'pathwaysService')\n  );\n\n  useEffect(() => {\n    if (service.status === 'loaded' && evaluatedPathways.length === 0)\n      setEvaluatedPathways(\n        service.payload.map(pathway => ({ pathway: pathway, pathwayResults: null }))\n      );\n  }, [service, evaluatedPathways.length, client, patientRecords]);\n\n  // Set the height of the graph container\n  useEffect(() => {\n    if (graphContainerElement?.current && headerElement?.current) {\n      graphContainerElement.current.style.height =\n        window.innerHeight - headerElement.current.clientHeight + 'px';\n    }\n  }, [selectPathway]);\n\n  function setEvaluatedPathwayCallback(\n    value: EvaluatedPathway | null,\n    selectPathway = false\n  ): void {\n    window.scrollTo(0, 0);\n    setSelectPathway(selectPathway);\n    setCurrentPathway(value);\n  }\n\n  const updateEvaluatedPathways = useCallback(\n    (value: EvaluatedPathway) => {\n      const newList = [...evaluatedPathways]; // Create a shallow copy of list\n      for (let i = 0; i < evaluatedPathways.length; i++) {\n        if (evaluatedPathways[i].pathway.name === value.pathway.name) {\n          newList[i] = value;\n          setEvaluatedPathways(newList);\n        }\n      }\n\n      if (currentPathway?.pathway.name === value.pathway.name) {\n        setCurrentPathway(value);\n      }\n    },\n    [currentPathway, evaluatedPathways]\n  );\n\n  const assignPathway = useCallback(\n    (pathwayName: string): void => {\n      if (!patient) return;\n\n      const carePlan = createCarePlan(pathwayName, patient);\n\n      setPatientRecords([...patientRecords, carePlan]);\n      client?.create?.(carePlan);\n    },\n    [patientRecords, patient, client, setPatientRecords]\n  );\n\n  const unassignPathway = useCallback(\n    (pathwayName: string): void => {\n      const newPatientRecords: DomainResource[] = [];\n      patientRecords.forEach(r => {\n        if (r.resourceType === 'CarePlan' && (r as CarePlan).title === pathwayName)\n          client?.delete?.(`CarePlan/${r.id}`);\n        else newPatientRecords.push(r);\n      });\n      setPatientRecords(newPatientRecords);\n    },\n    [patientRecords, setPatientRecords, client]\n  );\n\n  return (\n    <ThemeProvider>\n      <FHIRClientProvider client={client as PathwaysClient}>\n        <UserProvider value={{ user, setUser }}>\n          <PatientProvider value={{ patient, setPatient }}>\n            <PatientRecordsProvider value={providerProps}>\n              <PathwayProvider\n                pathwayCtx={{\n                  updateEvaluatedPathways,\n                  evaluatedPathway: currentPathway,\n                  setEvaluatedPathway: setEvaluatedPathwayCallback,\n                  assignPathway: assignPathway,\n                  unassignPathway: unassignPathway\n                }}\n              >\n                <div ref={headerElement}>\n                  <Header logo={logo} />\n\n                  <Navigation\n                    evaluatedPathways={evaluatedPathways}\n                    selectPathway={selectPathway}\n                    setSelectPathway={setSelectPathway}\n                  />\n                </div>\n\n                {selectPathway ? (\n                  <PathwaysList\n                    evaluatedPathways={evaluatedPathways}\n                    callback={setEvaluatedPathwayCallback}\n                    service={service}\n                    headerElement={headerElement}\n                  />\n                ) : (\n                  <PatientView\n                    key={currentPathway?.pathway.name ?? ''}\n                    headerElement={headerElement}\n                    graphContainerElement={graphContainerElement}\n                  />\n                )}\n              </PathwayProvider>\n            </PatientRecordsProvider>\n          </PatientProvider>\n        </UserProvider>\n      </FHIRClientProvider>\n    </ThemeProvider>\n  );\n};\n\ninterface PatientViewProps {\n  headerElement: RefObject<HTMLDivElement>;\n  graphContainerElement: RefObject<HTMLDivElement>;\n}\n\nconst PatientView: FC<PatientViewProps> = ({ headerElement, graphContainerElement }) => {\n  return (\n    <div className={styles.display}>\n      <PatientRecord headerElement={headerElement} />\n\n      <div ref={graphContainerElement} className={styles.graph}>\n        <Graph expandCurrentNode={true} />\n      </div>\n    </div>\n  );\n};\n\nfunction getFixture(filename: string): Promise<string> {\n  return fetch(`./static/cql/${filename}`).then(cql => cql.text());\n}\n\nexport default App;\n","import 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter as Router, Route, Switch } from 'react-router-dom';\nimport App from './components/App.tsx';\nimport './styles/index.module.scss';\n\nconst rootElement = document.getElementById('root');\n\nReactDOM.render(\n  <Router>\n    <Switch>\n      <Route exact path=\"/\" render={() => <App />}></Route>\n      <Route\n        path=\"/demo/:id\"\n        render={props => <App demoId={props.match.params.id} key={props.match.params.id} />}\n      ></Route>\n      <Route path=\"/demo\" render={() => <App demoId={'Maureen'} />}></Route>\n    </Switch>\n  </Router>,\n  rootElement\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"selectButton\":\"ActionButton_selectButton___qB5R\",\"accept\":\"ActionButton_accept__28b2D\",\"decline\":\"ActionButton_decline__zz-vG\",\"smallActionButton\":\"ActionButton_smallActionButton__1bPWu\",\"largeActionButton\":\"ActionButton_largeActionButton__blRdA\",\"largeDecline\":\"ActionButton_largeDecline__wz9Zw\",\"mediumActionButton\":\"ActionButton_mediumActionButton__3EpOp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"patientSnapshot\":\"PatientSnapshot_patientSnapshot__3bGcm\",\"patientSnapshot__info\":\"PatientSnapshot_patientSnapshot__info__2Ry7e\",\"patientName\":\"PatientSnapshot_patientName__ZClJB\",\"patientSnapshot__photo\":\"PatientSnapshot_patientSnapshot__photo__3XI7U\",\"patientSnapshot__list\":\"PatientSnapshot_patientSnapshot__list__5DVC3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navigation\":\"Navigation_navigation__1EgxP\",\"navigation__back\":\"Navigation_navigation__back__2cVZ2\",\"navigation__leftPanel\":\"Navigation_navigation__leftPanel__QjHPF\",\"navigation__rightPanel\":\"Navigation_navigation__rightPanel__1FRD3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"reportModal\":\"ReportModal_reportModal__2hppG\",\"sectionContainer\":\"ReportModal_sectionContainer__1iIQM\",\"confirmationSection\":\"ReportModal_confirmationSection__2HXo4\",\"confirmationButtonGroup\":\"ReportModal_confirmationButtonGroup__1FN9I\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"arrow\":\"Arrow_arrow__3TM91\",\"arrowhead\":\"Arrow_arrowhead__3XjQ0\",\"arrowOnPatientPath\":\"Arrow_arrowOnPatientPath__1r5CB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dropdown\":\"DropDown_dropdown__1KvCw\",\"check\":\"DropDown_check__2pubh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"display\":\"App_display__2vneK\",\"graph\":\"App_graph__3EP_l\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"pathways_list\":\"PathwaysList_pathways_list__2WO5g\",\"header_title\":\"PathwaysList_header_title__7EM8s\",\"header_title__header\":\"PathwaysList_header_title__header__36yqh\",\"header_title__note\":\"PathwaysList_header_title__note__34zC8\",\"container\":\"PathwaysList_container__1SC5K\",\"assignedPathwayElement\":\"PathwaysList_assignedPathwayElement__2xpdU\",\"title\":\"PathwaysList_title__ccVmw\",\"numElements\":\"PathwaysList_numElements__1WAOk\",\"expand\":\"PathwaysList_expand__2v9Wx\",\"infoContainer\":\"PathwaysList_infoContainer__2q0Tn\",\"details\":\"PathwaysList_details__2kSzT\",\"pathway\":\"PathwaysList_pathway__1vqM1\",\"matchingElement\":\"PathwaysList_matchingElement__1SQoM\",\"controls\":\"PathwaysList_controls__vZmz8\",\"pathwayElement\":\"PathwaysList_pathwayElement__34hJh\",\"matchedElementsLabel\":\"PathwaysList_matchedElementsLabel__3cXeX\",\"pathwayListHeaderContainer\":\"PathwaysList_pathwayListHeaderContainer__2l2fi\"};"],"sourceRoot":""}